!function(){"use strict";!function(){var e={editable:function(t,n){return n=n||{},n.srcNode=t,e.implementEventTarget(),new e.Core(n)},getBasePath:function(){var t=window.ALLOYEDITOR_BASEPATH||"";if(!t)for(var n=document.getElementsByTagName("script"),o=0;o<n.length;o++){var i=n[o].src.match(e.regexBasePath);if(i){t=i[1];break}}if(-1===t.indexOf(":/")&&"//"!==t.slice(0,2)&&(t=0===t.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+t:location.href.match(/^[^\?]*\/(?:)/)[0]+t),!t)throw'The AlloyEditor installation path could not be automatically detected. Please set the global variable "ALLOYEDITOR_BASEPATH" before creating editor instances.';return t},loadLanguageResources:function(t){if(e.implementEventTarget(),e.Lang.isFunction(t)&&(e.Strings?setTimeout(t,0):e.once("languageResourcesLoaded",t)),!e._langResourceRequested){e._langResourceRequested=!0;var n=["af","ar","bg","bn","bs","ca","cs","cy","da","de","el","en-au","en-ca","en-gb","en","eo","es","et","eu","fa","fi","fo","fr-ca","fr","gl","gu","he","hi","hr","hu","id","is","it","ja","ka","km","ko","ku","lt","lv","mk","mn","ms","nb","nl","no","pl","pt-br","pt","ro","ru","si","sk","sl","sq","sr-latn","sr","sv","th","tr","tt","ug","uk","vi","zh-cn","zh"],o=navigator.language||navigator.userLanguage||"en",i=o.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),r=i[1],a=i[2];n[r+"-"+a]?r=r+"-"+a:n.indexOf(r)||(r="en"),CKEDITOR.scriptLoader.load(e.getUrl("lang/alloy-editor/"+r+".js"),function(t){t&&e.fire("languageResourcesLoaded")},this)}},getUrl:function(t){var n=e.getBasePath();return-1===t.indexOf(":/")&&0!==t.indexOf("/")&&(t=n+t),CKEDITOR.timestamp&&"/"!==t.charAt(t.length-1)&&!/[&?]t=/.test(t)&&(t+=(t.indexOf("?")>=0?"&":"?")+"t="+CKEDITOR.timestamp),t},implementEventTarget:function(){e.fire||e.on||CKEDITOR.event.implementOn(e)},regexBasePath:/(^|.*[\\\/])(?:alloy-editor[^/]+|alloy-editor)\.js(?:\?.*|;.*)?$/i,Buttons:{},Toolbars:{}};"undefined"!=typeof module&&"object"==typeof module.exports&&(module.exports=e),"undefined"!=typeof window?window.AlloyEditor=e:"undefined"!=typeof global?global.AlloyEditor=e:"undefined"!=typeof self?self.AlloyEditor=e:this.AlloyEditor=e}();var e=function(){return(0,eval)("this").React}();"undefined"==typeof e&&(e=AlloyEditor.React);var t=function(){return(0,eval)("this").ReactDOM}();"undefined"==typeof e&&(t=AlloyEditor.ReactDOM),"undefined"!=typeof window&&(!function(){CKEDITOR.tools.debounce=CKEDITOR.tools.debounce||function(e,t,n,o){var i,r=function(){var r=n||this;clearTimeout(i);for(var a=[],s=arguments.length,l=0;s>l;++l)a.push(arguments[l]);var d=a.concat(o||[]);i=setTimeout(function(){e.apply(r,d)},t)};return r.detach=function(){clearTimeout(i)},r}}(),function(){function e(e){this._editor=e}var t=/^(?:[a-z][a-z0-9+\-.]*)\:|^\//i;e.prototype={constructor:e,create:function(e,t){var n=this._editor.getSelection(),o=n.getRanges()[0];if(o.collapsed){var i=new CKEDITOR.dom.text(e,this._editor.document);o.insertNode(i),o.selectNodeContents(i)}e=this._getCompleteURI(e);var r=CKEDITOR.tools.merge({"data-cke-saved-href":e,href:e},t),a=new CKEDITOR.style({attributes:r,element:"a"});a.type=CKEDITOR.STYLE_INLINE,a.applyToRange(o,this._editor),o.select()},getFromSelection:function(){var e=this._editor.getSelection(),t=e.getSelectedElement();if(t&&t.is("a"))return t;var n=e.getRanges()[0];return n?(n.shrink(CKEDITOR.SHRINK_TEXT),this._editor.elementPath(n.getCommonAncestor()).contains("a",1)):null},remove:function(e){var t=this._editor;if(e)e.remove(t);else{var n=e||new CKEDITOR.style({alwaysRemoveElement:1,element:"a",type:CKEDITOR.STYLE_INLINE}),o=t.getSelection();o.selectElement(o.getStartElement()),t.removeStyle(n)}},update:function(e,t){var n=t||this.getFromSelection();n.setAttributes({"data-cke-saved-href":e,href:e})},_getCompleteURI:function(e){return t.test(e)||(e="http://"+e),e}},CKEDITOR.Link=CKEDITOR.Link||e}(),function(){function e(){}CKEDITOR.plugins.get("ae_selectionregion")||(CKEDITOR.SELECTION_TOP_TO_BOTTOM=0,CKEDITOR.SELECTION_BOTTOM_TO_TOP=1,CKEDITOR.SELECTION_LEFT_TO_RIGHT=2,CKEDITOR.SELECTION_RIGHT_TO_LEFT=3,e.prototype={constructor:e,createSelectionFromPoint:function(e,t){this.createSelectionFromRange(e,t,e,t)},createSelectionFromRange:function(e,t,n,o){var i,r,a,s,l,d,c;if("function"==typeof document.caretPositionFromPoint?(l=document.caretPositionFromPoint(e,t),i=document.caretPositionFromPoint(n,o),d=l.offsetNode,r=i.offsetNode,c=l.offset,a=i.offset,s=this.createRange()):"function"==typeof document.caretRangeFromPoint&&(l=document.caretRangeFromPoint(e,t),i=document.caretRangeFromPoint(n,o),d=l.startContainer,r=i.startContainer,c=l.startOffset,a=i.startOffset,s=this.createRange()),s&&document.getSelection)s.setStart(new CKEDITOR.dom.node(d),c),s.setEnd(new CKEDITOR.dom.node(r),a),this.getSelection().selectRanges([s]);else if("function"==typeof document.body.createTextRange){var u=this.getSelection();u.unlock(),s=document.body.createTextRange(),s.moveToPoint(e,t);var p=s.duplicate();p.moveToPoint(n,o),s.setEndPoint("EndToEnd",p),s.select(),this.getSelection().lock()}},getCaretRegion:function(){var e=this.getSelection(),t={bottom:0,left:0,right:0,top:0},n=e.createBookmarks();if(!n.length)return t;var o=n[0].startNode.$;o.style.display="inline-block";var t=new CKEDITOR.dom.element(o).getClientRect();o.parentNode.removeChild(o);var i=new CKEDITOR.dom.window(window).getScrollPosition();return t.bottom=i.y+t.bottom,t.left=i.x+t.left,t.right=i.x+t.right,t.top=i.y+t.top,t},getSelectionData:function(){var e=this.getSelection();if(!e.getNative())return null;var t={element:e.getSelectedElement(),text:e.getSelectedText()};return t.region=this.getSelectionRegion(e),t},getSelectionRegion:function(){var e=this.getClientRectsRegion();return e.direction=this.getSelectionDirection(),e.height=e.bottom-e.top,e.width=e.right-e.left,e},isSelectionEmpty:function(){var e,t=this.getSelection();return t.getType()===CKEDITOR.SELECTION_NONE||(e=t.getRanges())&&1===e.length&&e[0].collapsed},getClientRectsRegion:function(){var e=this.getSelection(),t=e.getNative(),n={bottom:0,height:0,left:0,right:0,top:0,width:0},o={bottom:0,endRect:n,left:0,right:0,top:0,startRect:n};if(!t)return o;var i,r,a=0,s=1/0,l=-(1/0),d=1/0;if(t.createRange?i=t.createRange().getClientRects():(r=t.rangeCount,i=t.rangeCount>0?t.getRangeAt(0).getClientRects():[]),0===i.length)o=this.getCaretRegion();else{for(var c=0,u=i.length;u>c;c++){var p=i[c];p.left<s&&(s=p.left),p.right>l&&(l=p.right),p.top<d&&(d=p.top),p.bottom>a&&(a=p.bottom)}var m=new CKEDITOR.dom.window(window).getScrollPosition();if(o.bottom=m.y+a,o.left=m.x+s,o.right=m.x+l,o.top=m.y+d,i.length){var h=i[i.length-1],g=i[0];o.endRect={bottom:m.y+h.bottom,height:h.height,left:m.x+h.left,right:m.x+h.right,top:m.y+h.top,width:h.width},o.startRect={bottom:m.y+g.bottom,height:g.height,left:m.x+g.left,right:m.x+g.right,top:m.y+g.top,width:g.width}}}return o},getSelectionDirection:function(){var e=CKEDITOR.SELECTION_TOP_TO_BOTTOM,t=this.getSelection(),n=t.getNative();if(!n)return e;var o;if((o=n.anchorNode)&&o.compareDocumentPosition){var i=o.compareDocumentPosition(n.focusNode);(!i&&n.anchorOffset>n.focusOffset||i===Node.DOCUMENT_POSITION_PRECEDING)&&(e=CKEDITOR.SELECTION_BOTTOM_TO_TOP)}return e}},CKEDITOR.plugins.add("ae_selectionregion",{init:function(t){var n,o;o=Object.prototype.hasOwnProperty;for(n in e.prototype)o.call(e.prototype,n)&&"undefined"==typeof t[n]&&(t[n]=e.prototype[n])}}))}(),function(){function e(e){this._editor=e}var t={table:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1};e.HEADING_BOTH="Both",e.HEADING_COL="Column",e.HEADING_NONE="None",e.HEADING_ROW="Row",e.prototype={constructor:e,create:function(e){var t=this._editor,n=this._createElement("table");e=e||{};for(var o=n.append(this._createElement("tbody")),i=e.rows||1,r=e.cols||1,a=0;i>a;a++)for(var s=o.append(this._createElement("tr")),l=0;r>l;l++){var d=s.append(this._createElement("td"));d.appendBogus()}this.setAttributes(n,e.attrs),this.setHeading(n,e.heading),t.insertElement(n);var c=new CKEDITOR.dom.element(n.$.rows[0].cells[0]),u=t.createRange();return u.moveToPosition(c,CKEDITOR.POSITION_AFTER_START),u.select(),n},getFromSelection:function(){var e,t=this._editor.getSelection(),n=t.getSelectedElement();if(n&&n.is("table"))e=n;else{var o=t.getRanges();o.length>0&&(CKEDITOR.env.webkit&&o[0].shrink(CKEDITOR.NODE_ELEMENT),e=this._editor.elementPath(o[0].getCommonAncestor(!0)).contains("table",1))}return e},isEditable:function(e){return CKEDITOR.env.ie&&e.is(t)?e.hasAttribute("contenteditable")?"false"!==e.getAttribute("contenteditable"):this.isEditable(e.getParent()):!e.isReadOnly()},getHeading:function(t){if(t=t||this.getFromSelection(),!t)return null;for(var n=null!==t.$.tHead,o=!0,i=0;i<t.$.rows.length;i++){var r=t.$.rows[i].cells[0];if(r&&"th"!==r.nodeName.toLowerCase()){o=!1;break}}var a=e.HEADING_NONE;return n&&(a=e.HEADING_ROW),o&&(a=a===e.HEADING_ROW?e.HEADING_BOTH:e.HEADING_COL),a},remove:function(e){var t=this._editor;if(e)e.remove();else if(e=t.elementPath().contains("table",1)){var n=e.getParent(),o=t.editable();1!==n.getChildCount()||n.is("td","th")||n.equals(o)||(e=n);var i=t.createRange();i.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START),e.remove(),i.select()}},setAttributes:function(e,t){t&&Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})},setHeading:function(t,n){t=t||this.getFromSelection();var o,i,r,a=t.getElementsByTag("tbody").getItem(0),s=this.getHeading(t),l=s===e.HEADING_COL||s===e.HEADING_BOTH,d=n===e.HEADING_COL||n===e.HEADING_BOTH,c=n===e.HEADING_ROW||n===e.HEADING_BOTH;if(!t.$.tHead&&c){var u=a.getElementsByTag("tr").getItem(0),p=u.getChildCount();for(o=0;p>o;o++){var m=u.getChild(o);m.type!==CKEDITOR.NODE_ELEMENT||m.data("cke-bookmark")||(m.renameNode("th"),m.setAttribute("scope","col"))}r=this._createElement(t.$.createTHead()),r.append(u.remove())}if(null!==t.$.tHead&&!c){r=this._createElement(t.$.tHead);for(var h=a.getFirst();r.getChildCount()>0;){var g=r.getFirst(),y=g.getChildCount();for(o=0;y>o;o++)i=g.getChild(o),i.type===CKEDITOR.NODE_ELEMENT&&(i.renameNode("td"),i.removeAttribute("scope"));g.insertBefore(h)}r.remove()}s=this.getHeading(t);var f=s===e.HEADING_COL||s===e.HEADING_BOTH;if(!f&&d)for(o=0;o<t.$.rows.length;o++)"th"!==t.$.rows[o].cells[0].nodeName.toLowerCase()&&(i=new CKEDITOR.dom.element(t.$.rows[o].cells[0]),i.renameNode("th"),i.setAttribute("scope","row"));if(l&&!d)for(o=0;o<t.$.rows.length;o++){var E=new CKEDITOR.dom.element(t.$.rows[o]);"tbody"===E.getParent().getName()&&(i=new CKEDITOR.dom.element(E.$.cells[0]),i.renameNode("td"),i.removeAttribute("scope"))}},_createElement:function(e){return new CKEDITOR.dom.element(e,this._editor.document)}},CKEDITOR.on("instanceReady",function(t){var n=[e.HEADING_NONE,e.HEADING_ROW,e.HEADING_COL,e.HEADING_BOTH],o=new e(t.editor);n.forEach(function(e){t.editor.addCommand("tableHeading"+e,{exec:function(t){o.setHeading(null,e)}})})}),CKEDITOR.Table=CKEDITOR.Table||e}(),function(){CKEDITOR.tools.merge=CKEDITOR.tools.merge||function(){for(var e={},t=0;t<arguments.length;++t){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},CKEDITOR.tools.simulate=function(e,t){var n=document.createEvent("Events");n.initEvent(t,!0,!1),e.dispatchEvent(n)}}(),function(){CKEDITOR.plugins.get("ae_uicore")||CKEDITOR.plugins.add("ae_uicore",{init:function(e){var t=[],n=this._createAriaElement(e.id),o=e.config.uicore?e.config.uicore.timeout:50,i=CKEDITOR.tools.debounce(function(e){n.innerHTML=t.join(". ")},o),r=CKEDITOR.tools.debounce(function(n){if(t=[],"keyup"!==n.name||27!==n.data.$.keyCode||e.config.allowEsc){var o=e.getSelectionData();o&&e.fire("editorInteraction",{nativeEvent:n.data.$,selectionData:o})}},o);e.on("ariaUpdate",function(e){t.push(e.data.message),i()}),e.once("contentDom",function(){var t=e.editable();t.attachListener(t,"mouseup",r),t.attachListener(t,"keyup",r)}),e.on("destroy",function(e){n.parentNode.removeChild(n),r.detach()})},_createAriaElement:function(e){var t=document.createElement("div");return t.className="ae-sr-only",t.setAttribute("aria-live","polite"),t.setAttribute("role","status"),t.setAttribute("id",e+"LiveRegion"),document.body.appendChild(t),t}})}(),function(){var e=CKEDITOR.env.ie;CKEDITOR.plugins.get("ae_addimages")||CKEDITOR.plugins.add("ae_addimages",{init:function(e){e.once("contentDom",function(){var t=e.editable();t.attachListener(t,"dragenter",this._onDragEnter,this,{editor:e}),t.attachListener(t,"dragover",this._onDragOver,this,{editor:e}),t.attachListener(t,"drop",this._onDragDrop,this,{editor:e}),t.attachListener(t,"paste",this._onPaste,this,{editor:e})}.bind(this))},_handleFiles:function(e,t){for(var n=0;n<e.length;n++){var o=e[n];0===o.type.indexOf("image")&&this._processFile(o,t)}return!1},_onDragEnter:function(t){e&&this._preventEvent(t)},_onDragOver:function(t){e&&this._preventEvent(t)},_onDragDrop:function(e){var t=e.data.$;new CKEDITOR.dom.event(t).preventDefault();var n=e.listenerData.editor;e.listenerData.editor.createSelectionFromPoint(t.clientX,t.clientY),this._handleFiles(t.dataTransfer.files,n)},_onPaste:function(e){if(e.data.$.clipboardData){var t=e.data.$.clipboardData.items[0];if(0===t.type.indexOf("image")){var n=t.getAsFile();this._processFile(n,e.listenerData.editor)}}},_preventEvent:function(e){e=new CKEDITOR.dom.event(e.data.$),e.preventDefault(),e.stopPropagation()},_processFile:function(e,t){var n=new FileReader;n.addEventListener("loadend",function(){var o=n.result,i=CKEDITOR.dom.element.createFromHtml('<img src="'+o+'">');t.insertElement(i);var r={el:i,file:e};t.fire("imageAdd",r)}),n.readAsDataURL(e)}})}(),function(){if(!CKEDITOR.plugins.get("ae_autolink")){/MSIE ([^;]*)|Trident.*; rv:([0-9.]+)/.test(navigator.userAgent)&&document.execCommand("AutoUrlDetect",!1,!1);var e=8,t=188,n=13,o=186,i=32,r=[t,n,o,i],a=/[^\s]+/gm,s=/(https?\:\/\/|www\.)(-\.)?([^\s/?\.#-]+\.?)+(\/[^\s]*)?$/i;CKEDITOR.plugins.add("ae_autolink",{init:function(e){e.once("contentDom",function(){var t=e.editable();t.attachListener(t,"keyup",this._onKeyUp,this,{editor:e})}.bind(this))},_getLastWord:function(e){var t=e.getSelection().getRanges()[0],o=t.startOffset,i="";if(this._currentKeyCode===n){var r,s=t.startContainer.getPrevious();if(s){for(;!s.getLast;)s=s.getPrevious();for(r=s.getLast();r&&!r.getText();)r=r.getPrevious()}r&&r.$.href||(this._startContainer=r,i=r?r.getText():"",this._offset=i.length)}else this._startContainer=t.startContainer,i=this._startContainer.getText().substring(0,o-1),this._offset=o-1;var l="",d=i.match(a);return d&&(l=d.pop()),l},_isValidURL:function(e){return s.test(e)},_onKeyDown:function(t){var n=t.data.$,o=t.listenerData.editor,i=o.editable();i.removeListener("keydown",this._onKeyDown),n.keyCode===e&&(t.cancel(),t.data.preventDefault(),this._removeLink(o)),this._ckLink=null},_onKeyUp:function(e){var t=e.data.$;if(this._currentKeyCode=t.keyCode,-1!==r.indexOf(this._currentKeyCode)){var n=e.listenerData.editor,o=this._getLastWord(n);this._isValidURL(o)&&this._replaceContentByLink(n,o)}},_replaceContentByLink:function(e,t){var o=e.createRange(),i=CKEDITOR.dom.element.get(this._startContainer),r=this._offset;o.setStart(i,r-t.length),o.setEnd(i,r),o.select();var a=new CKEDITOR.Link(e);if(a.create(t),this._ckLink=a,this._subscribeToKeyEvent(e),o=e.getSelection().getRanges()[0],this._currentKeyCode===n){var s=o.getNextEditableNode();o.setStart(s,0),o.setEnd(s,0)}else{var l=o.getNextNode();o.setStart(l,1),o.setEnd(l,1)}o.select()},_removeLink:function(e){var t=e.getSelection().getRanges()[0],n=t.startOffset,o=this._startContainer.getNext()||this._startContainer,i=e.createRange();i.setStart(o,0),i.setEndAfter(o),i.select(),this._ckLink.remove(),t.setEnd(t.startContainer,n),t.setStart(t.startContainer,n),t.select()},_subscribeToKeyEvent:function(e){var t=e.editable();t.attachListener(t,"keydown",this._onKeyDown,this,{editor:e},1)}})}}(),function(){function e(e){function n(){var t=e.getSelection();t&&(t.getType()!==CKEDITOR.SELECTION_NONE&&t.getStartElement().is("img")?o.event&&o.event.button&&0!==o.event.button||a.show(t.getStartElement().$):a.hide())}var o=e.window.$,i=e.document.$,r="undefined"==typeof l?null:l,a=new t(e,{snapToSize:r});i.addEventListener("mousedown",function(e){a.isHandle(e.target)&&a.initDrag(e)},!1),e.on("selectionChange",n),e.on("getData",function(e){var t=e.data.dataValue||"";t=t.replace(/<div id="ckimgrsz"([\s\S]*?)<\/div>/i,""),t=t.replace(/\b(ckimgrsz)\b/g,""),e.data.dataValue=t}),e.on("beforeUndoImage",function(){a.hide()}),e.on("afterUndoImage",function(){n()}),e.on("blur",function(){a.hide()}),e.on("beforeModeUnload",function d(){e.removeListener("beforeModeUnload",d),a.hide()});var s;e.window.on("resize",function(){clearTimeout(s),s=setTimeout(n,50)})}function t(e,t){this.editor=e,this.window=e.window.$,this.document=e.document.$,this.cfg=t||{},this.init()}function n(e,t){this.window=e,this.document=t,this.events={mousemove:i(this.mousemove,this),keydown:i(this.keydown,this),mouseup:i(this.mouseup,this)}}function o(e){for(var t=e.length,n=new Array(t),o=0;t>o;o++)n[o]=e[o];return n}function i(e,t){return e.bind?e.bind(t):function(){e.apply(t,arguments)}}function r(e,t,n){e.style.left=String(t)+"px",e.style.top=String(n)+"px"}function a(e,t,n){e.style.width=String(t)+"px",e.style.height=String(n)+"px"}function s(e,t){var n=t.getBoundingClientRect();return{left:n.left+e.pageXOffset,top:n.top+e.pageYOffset,width:n.width,height:n.height}}if(!CKEDITOR.plugins.get("dragresize")&&!CKEDITOR.plugins.get("ae_dragresize")){var l=7,d="WebkitAppearance"in document.documentElement.style;d&&CKEDITOR.addCss("img::selection{color:rgba(0,0,0,0)}img.ckimgrsz{outline:1px dashed #000}#ckimgrsz{position:absolute;width:0;height:0;cursor:default;z-index:10001}#ckimgrsz span{display:none;position:absolute;top:0;left:0;width:0;height:0;background-size:100% 100%;opacity:.65;outline:1px dashed #000}#ckimgrsz i{position:absolute;display:block;width:5px;height:5px;background:#fff;border:1px solid #000}#ckimgrsz i.active,#ckimgrsz i:hover{background:#000}#ckimgrsz i.br,#ckimgrsz i.tl{cursor:nwse-resize}#ckimgrsz i.bm,#ckimgrsz i.tm{cursor:ns-resize}#ckimgrsz i.bl,#ckimgrsz i.tr{cursor:nesw-resize}#ckimgrsz i.lm,#ckimgrsz i.rm{cursor:ew-resize}body.dragging-br,body.dragging-br *,body.dragging-tl,body.dragging-tl *{cursor:nwse-resize!important}body.dragging-bm,body.dragging-bm *,body.dragging-tm,body.dragging-tm *{cursor:ns-resize!important}body.dragging-bl,body.dragging-bl *,body.dragging-tr,body.dragging-tr *{cursor:nesw-resize!important}body.dragging-lm,body.dragging-lm *,body.dragging-rm,body.dragging-rm *{cursor:ew-resize!important}"),CKEDITOR.plugins.add("ae_dragresize",{onLoad:function(){},init:function(t){d&&t.once("contentDom",function(n){e(t)})}}),t.prototype={init:function(){var e=this.container=this.document.createElement("div");e.id="ckimgrsz",this.preview=this.document.createElement("span"),e.appendChild(this.preview);var t=this.handles={tl:this.createHandle("tl"),tm:this.createHandle("tm"),tr:this.createHandle("tr"),lm:this.createHandle("lm"),rm:this.createHandle("rm"),bl:this.createHandle("bl"),bm:this.createHandle("bm"),br:this.createHandle("br")};for(var n in t)e.appendChild(t[n])},createHandle:function(e){var t=this.document.createElement("i");return t.classList.add(e),t},isHandle:function(e){var t=this.handles;for(var n in t)if(t[n]===e)return!0;return!1},show:function(e){this.el=e,this.cfg.snapToSize&&(this.otherImages=o(this.document.getElementsByTagName("img")),this.otherImages.splice(this.otherImages.indexOf(e),1));var t=this.box=s(this.window,e);r(this.container,t.left,t.top),this.document.body.appendChild(this.container),this.el.classList.add("ckimgrsz"),this.showHandles()},hide:function(){for(var e=this.document.getElementsByClassName("ckimgrsz"),t=0;t<e.length;++t)e[t].classList.remove("ckimgrsz");this.hideHandles(),this.container.parentNode&&this.container.parentNode.removeChild(this.container)},initDrag:function(e){if(0===e.button){var t=this,o=new n(this.window,this.document);o.onStart=function(){t.showPreview(),t.isDragging=!0,t.editor.getSelection().lock()},o.onDrag=function(){t.calculateSize(this),t.updatePreview();var e=t.previewBox;t.updateHandles(e,e.left,e.top)},o.onRelease=function(){t.isDragging=!1,t.hidePreview(),t.hide(),t.editor.getSelection().unlock(),t.editor.fire("saveSnapshot")},o.onComplete=function(){t.resizeComplete(),t.editor.fire("saveSnapshot")},o.start(e)}},updateHandles:function(e,t,n){t=t||0,n=n||0;var o=this.handles;r(o.tl,-3+t,-3+n),r(o.tm,Math.round(e.width/2)-3+t,-3+n),r(o.tr,e.width-4+t,-3+n),r(o.lm,-3+t,Math.round(e.height/2)-3+n),r(o.rm,e.width-4+t,Math.round(e.height/2)-3+n),r(o.bl,-3+t,e.height-4+n),r(o.bm,Math.round(e.width/2)-3+t,e.height-4+n),r(o.br,e.width-4+t,e.height-4+n)},showHandles:function(){var e=this.handles;this.updateHandles(this.box);for(var t in e)e[t].style.display="block"},hideHandles:function(){var e=this.handles;for(var t in e)e[t].style.display="none"},showPreview:function(){this.preview.style.backgroundImage='url("'+this.el.src+'")',this.calculateSize(),this.updatePreview(),this.preview.style.display="block"},updatePreview:function(){var e=this.previewBox;r(this.preview,e.left,e.top),a(this.preview,e.width,e.height)},hidePreview:function(){var e=s(this.window,this.preview);this.result={width:e.width,height:e.height},this.preview.style.display="none"},calculateSize:function(e){var t=this.previewBox={top:0,left:0,width:this.box.width,height:this.box.height};if(e){var n=e.target.className;if(~n.indexOf("r")&&(t.width=Math.max(32,this.box.width+e.delta.x)),~n.indexOf("b")&&(t.height=Math.max(32,this.box.height+e.delta.y)),~n.indexOf("l")&&(t.width=Math.max(32,this.box.width-e.delta.x)),~n.indexOf("t")&&(t.height=Math.max(32,this.box.height-e.delta.y)),n.indexOf("m")<0&&!e.keys.shift){var o=this.box.width/this.box.height;t.width/t.height>o?t.height=Math.round(t.width/o):t.width=Math.round(t.height*o)}var i=this.cfg.snapToSize;if(i)for(var r=this.otherImages,a=0;a<r.length;a++){var l=s(this.window,r[a]);if(Math.abs(t.width-l.width)<=i&&Math.abs(t.height-l.height)<=i){t.width=l.width,t.height=l.height;break}}~n.indexOf("l")&&(t.left=this.box.width-t.width),~n.indexOf("t")&&(t.top=this.box.height-t.height)}},resizeComplete:function(){a(this.el,this.result.width,this.result.height)}},n.prototype={start:function(e){e.preventDefault(),e.stopPropagation(),this.target=e.target,this.attr=e.target.className,this.startPos={x:e.clientX,y:e.clientY},this.update(e);var t=this.events;this.document.addEventListener("mousemove",t.mousemove,!1),this.document.addEventListener("keydown",t.keydown,!1),this.document.addEventListener("mouseup",t.mouseup,!1),this.document.body.classList.add("dragging-"+this.attr),this.onStart&&this.onStart()},update:function(e){this.currentPos={x:e.clientX,y:e.clientY},this.delta={x:e.clientX-this.startPos.x,y:e.clientY-this.startPos.y},this.keys={shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey}},mousemove:function(e){this.update(e),this.onDrag&&this.onDrag(),0===e.which&&this.mouseup(e)},keydown:function(e){27===e.keyCode&&this.release()},mouseup:function(e){this.update(e),this.release(),this.onComplete&&this.onComplete()},release:function(){this.document.body.classList.remove("dragging-"+this.attr);var e=this.events;this.document.removeEventListener("mousemove",e.mousemove,!1),this.document.removeEventListener("keydown",e.keydown,!1),this.document.removeEventListener("mouseup",e.mouseup,!1),this.onRelease&&this.onRelease()}}}}(),function(){CKEDITOR.plugins.get("ae_pasteimages")||CKEDITOR.plugins.add("ae_pasteimages",{init:function(e){e.once("contentDom",function(){var t=e.editable();t.attachListener(t,"paste",this._onPaste,this,{editor:e})}.bind(this))},_onPaste:function(e){if(e.data.$.clipboardData){var t=e.data.$.clipboardData.items[0],n=e.listenerData.editor;if(0===t.type.indexOf("image")){var o=new FileReader,i=t.getAsFile();o.onload=function(e){var t=CKEDITOR.dom.element.createFromHtml('<img src="'+e.target.result+'">');n.insertElement(t);var o={el:t,file:i};n.fire("imageAdd",o)}.bind(this),o.readAsDataURL(i)}}}})}(),function(){CKEDITOR.plugins.get("ae_placeholder")||CKEDITOR.plugins.add("ae_placeholder",{init:function(e){e.on("blur",this._checkEmptyData,this),e.once("contentDom",this._checkEmptyData,this)},_checkEmptyData:function(e){var t=e.editor;if(""===t.getData()){var n=new CKEDITOR.dom.element(t.element.$);n.setHtml(""),n.addClass(t.config.placeholderClass)}}})}(),function(){function e(e){return CKEDITOR.env.ie?e.$.clientWidth:parseInt(e.getComputedStyle("width"),10)}function t(e,t){var n=e.getComputedStyle("border-"+t+"-width"),o={thin:"0px",medium:"1px",thick:"2px"};return n.indexOf("px")<0&&(n=n in o&&"none"!=e.getComputedStyle("border-style")?o[n]:0),parseInt(n,10)}function n(e){for(var t,n,o,i=e.$.rows,r=0,a=0,s=i.length;s>a;a++)o=i[a],t=o.cells.length,t>r&&(r=t,n=o);return n}function o(e){for(var o=[],i=-1,r="rtl"===e.getComputedStyle("direction"),a=n(e),s=new CKEDITOR.dom.element(e.$.tBodies[0]),l=s.getDocumentPosition(),d=0,c=a.cells.length;c>d;d++){var u=new CKEDITOR.dom.element(a.cells[d]),p=a.cells[d+1]&&new CKEDITOR.dom.element(a.cells[d+1]);i+=u.$.colSpan||1;var m,h,g,y=u.getDocumentPosition().x;r?h=y+t(u,"left"):m=y+u.$.offsetWidth-t(u,"right"),p?(y=p.getDocumentPosition().x,r?m=y+p.$.offsetWidth-t(p,"right"):h=y+t(p,"left")):(y=e.getDocumentPosition().x,r?m=y:h=y+e.$.offsetWidth),g=Math.max(h-m,4),o.push({table:e,index:i,x:m,y:l.y,width:g,height:s.$.offsetHeight,rtl:r})}return o}function i(e,t){for(var n=0,o=e.length;o>n;n++){var i=e[n];if(t>=i.x&&t<=i.x+i.width)return i}return null}function r(e){(e.data||e).preventDefault()}function a(n){function o(){p=null,f=0,g=0,m.removeListener("mouseup",c),h.removeListener("mousedown",d),h.removeListener("mousemove",u),m.getBody().setStyle("cursor","auto")}function i(){for(var t=p.index,n=CKEDITOR.tools.buildTableMap(p.table),o=[],i=[],a=Number.MAX_VALUE,s=a,l=p.rtl,d=0,c=n.length;c>d;d++){var C=n[d],A=C[t+(l?1:0)],I=C[t+(l?0:1)];A=A&&new CKEDITOR.dom.element(A),I=I&&new CKEDITOR.dom.element(I),A&&I&&A.equals(I)||(A&&(a=Math.min(a,e(A))),I&&(s=Math.min(s,e(I))),o.push(A),i.push(I))}E=o,b=i,v=p.x-a,T=p.x+s,h.setOpacity(.5),y=parseInt(h.getStyle("left"),10),f=0,g=1,h.on("mousemove",u),m.on("dragstart",r)}function a(){g=0,h.setOpacity(0),f&&s();var e=p.table;setTimeout(function(){e.removeCustomData("_cke_table_pillars")},0),m.removeListener("dragstart",r)}function s(){for(var n=p.rtl,o=n?b.length:E.length,i=0;o>i;i++){var r=E[i],a=b[i],s=p.table;CKEDITOR.tools.setTimeout(function(e,t,o,i,r,a){e&&e.setStyle("width",l(Math.max(t+a,1))),o&&o.setStyle("width",l(Math.max(i-a,1))),r&&s.setStyle("width",l(r+a*(n?-1:1)))},0,this,[r,r&&e(r),a,a&&e(a),(!r||!a)&&e(s)+t(s,"left")+t(s,"right"),f])}}function d(e){r(e),i(),m.on("mouseup",c,this)}function c(e){e.removeListener(),a()}function u(e){C(e.data.getPageOffset().x)}var p,m,h,g,y,f,E,b,v,T;m=n.document,h=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',m),n.on("destroy",function(){h.remove()}),m.getDocumentElement().append(h),this.attachTo=function(e){g||(p=e,h.setStyles({width:l(e.width),height:l(e.height),left:l(e.x),top:l(e.y)}),h.on("mousedown",d,this),m.getBody().setStyle("cursor","col-resize"),h.show())};var C=this.move=function(e){if(!p)return 0;if(!g&&(e<p.x||e>p.x+p.width))return o(),0;var t=e-Math.round(h.$.offsetWidth/2);if(g){if(t===v||t===T)return 1;t=Math.max(t,v),t=Math.min(t,T),f=t-y}return h.setStyle("left",l(t)),1}}function s(e){var t=e.data.getTarget();if("mouseout"===e.name){if(!t.is("table"))return;for(var n=new CKEDITOR.dom.element(e.data.$.relatedTarget||e.data.$.toElement);n&&n.$&&!n.equals(t)&&!n.is("body");)n=n.getParent();if(!n||n.equals(t))return}t.getAscendant("table",1).removeCustomData("_cke_table_pillars"),e.removeListener()}if(!CKEDITOR.plugins.get("tableresize")&&!CKEDITOR.plugins.get("ae_tableresize")){var l=CKEDITOR.tools.cssLength;CKEDITOR.plugins.add("ae_tableresize",{requires:"ae_tabletools",init:function(e){e.on("contentDom",function(){var t,n=e.editable();n.attachListener(n.isInline()?n:e.document,"mousemove",function(n){n=n.data;var l=n.getTarget();if(l.type===CKEDITOR.NODE_ELEMENT){var d=n.getPageOffset().x;if(t&&t.move(d))return void r(n);var c,u;if((l.is("table")||l.getAscendant("tbody",1))&&(c=l.getAscendant("table",1),e.editable().contains(c))){(u=c.getCustomData("_cke_table_pillars"))||(c.setCustomData("_cke_table_pillars",u=o(c)),c.on("mouseout",s),c.on("mousedown",s));var p=i(u,d);p&&(!t&&(t=new a(e)),t.attachTo(p))}}})})}})}}(),function(){function e(e){function t(e){o.length>0||e.type==CKEDITOR.NODE_ELEMENT&&f.test(e.getName())&&!e.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(i,e,"selected_cell",!0),o.push(e))}for(var n=e.getRanges(),o=[],i={},r=0;r<n.length;r++){var a=n[r];if(a.collapsed){var s=a.getCommonAncestor(),l=s.getAscendant("td",!0)||s.getAscendant("th",!0);l&&o.push(l)}else{var d,c=new CKEDITOR.dom.walker(a);for(c.guard=t;d=c.next();)if(d.type!=CKEDITOR.NODE_ELEMENT||!d.is(CKEDITOR.dtd.table)){var u=d.getAscendant("td",!0)||d.getAscendant("th",!0);u&&!u.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(i,u,"selected_cell",!0),o.push(u))}}}return CKEDITOR.dom.element.clearAllMarkers(i),o}function t(e){for(var t,n,o,i=0,r=e.length-1,a={};t=e[i++];)CKEDITOR.dom.element.setMarker(a,t,"delete_cell",!0);for(i=0;t=e[i++];)if((n=t.getPrevious())&&!n.getCustomData("delete_cell")||(n=t.getNext())&&!n.getCustomData("delete_cell"))return CKEDITOR.dom.element.clearAllMarkers(a),n;return CKEDITOR.dom.element.clearAllMarkers(a),o=e[0].getParent(),(o=o.getPrevious())?o.getLast():(o=e[r].getParent(),(o=o.getNext())?o.getChild(0):null)}function n(t,n){for(var o=e(t),i=o[0],r=i.getAscendant("table"),a=i.getDocument(),s=o[0].getParent(),l=s.$.rowIndex,d=o[o.length-1],c=d.getParent().$.rowIndex+d.$.rowSpan-1,u=new CKEDITOR.dom.element(r.$.rows[c]),p=n?l:c,m=n?s:u,h=CKEDITOR.tools.buildTableMap(r),g=h[p],y=n?h[p-1]:h[p+1],f=h[0].length,E=a.createElement("tr"),b=0;g[b]&&f>b;b++){var v;g[b].rowSpan>1&&y&&g[b]==y[b]?(v=g[b],v.rowSpan+=1):(v=new CKEDITOR.dom.element(g[b]).clone(),v.removeAttribute("rowSpan"),v.appendBogus(),E.append(v),v=v.$),b+=v.colSpan-1}n?E.insertBefore(m):E.insertAfter(m)}function o(t){if(t instanceof CKEDITOR.dom.selection){for(var n=e(t),i=n[0],r=i.getAscendant("table"),a=CKEDITOR.tools.buildTableMap(r),s=n[0].getParent(),l=s.$.rowIndex,d=n[n.length-1],c=d.getParent().$.rowIndex+d.$.rowSpan-1,u=[],p=l;c>=p;p++){for(var m=a[p],h=new CKEDITOR.dom.element(r.$.rows[p]),g=0;g<m.length;g++){var y=new CKEDITOR.dom.element(m[g]),f=y.getParent().$.rowIndex;if(1==y.$.rowSpan)y.remove();else if(y.$.rowSpan-=1,f==p){var E=a[p+1];E[g-1]?y.insertAfter(new CKEDITOR.dom.element(E[g-1])):new CKEDITOR.dom.element(r.$.rows[p+1]).append(y,1)}g+=y.$.colSpan-1}u.push(h)}var b=r.$.rows,v=new CKEDITOR.dom.element(b[c+1]||(l>0?b[l-1]:null)||r.$.parentNode);for(p=u.length;p>=0;p--)o(u[p]);return v}return t instanceof CKEDITOR.dom.element&&(r=t.getAscendant("table"),1==r.$.rows.length?r.remove():t.remove()),null}function i(e,t){for(var n=e.getParent(),o=n.$.cells,i=0,r=0;r<o.length;r++){var a=o[r];if(i+=t?1:a.colSpan,a==e.$)break}return i-1}function r(e,t){for(var n=t?1/0:0,o=0;o<e.length;o++){var r=i(e[o],t);(t?n>r:r>n)&&(n=r)}return n}function a(t,n){for(var o=e(t),i=o[0],a=i.getAscendant("table"),s=r(o,1),l=r(o),d=n?s:l,c=CKEDITOR.tools.buildTableMap(a),u=[],p=[],m=c.length,h=0;m>h;h++){u.push(c[h][d]);var g=n?c[h][d-1]:c[h][d+1];p.push(g)}for(h=0;m>h;h++){var y;u[h]&&(u[h].colSpan>1&&p[h]==u[h]?(y=u[h],y.colSpan+=1):(y=new CKEDITOR.dom.element(u[h]).clone(),y.removeAttribute("colSpan"),y.appendBogus(),y[n?"insertBefore":"insertAfter"].call(y,new CKEDITOR.dom.element(u[h])),
y=y.$),h+=y.rowSpan-1)}}function s(t){for(var n,o,i=e(t),r=i[0],a=i[i.length-1],s=r.getAscendant("table"),l=CKEDITOR.tools.buildTableMap(s),d=[],c=0,u=l.length;u>c;c++)for(var p=0,m=l[c].length;m>p;p++)l[c][p]==r.$&&(n=p),l[c][p]==a.$&&(o=p);for(c=n;o>=c;c++)for(p=0;p<l.length;p++){var h=l[p],g=new CKEDITOR.dom.element(s.$.rows[p]),y=new CKEDITOR.dom.element(h[c]);y.$&&(1==y.$.colSpan?y.remove():y.$.colSpan-=1,p+=y.$.rowSpan-1,g.$.cells.length||d.push(g))}var f=s.$.rows[0]&&s.$.rows[0].cells,E=new CKEDITOR.dom.element(f[n]||(n?f[n-1]:s.$.parentNode));return d.length==u&&s.remove(),E}function l(e,t){var n=e.getStartElement(),o=n.getAscendant("td",1)||n.getAscendant("th",1);if(o){var i=o.clone();i.appendBogus(),t?i.insertBefore(o):i.insertAfter(o)}}function d(n){if(n instanceof CKEDITOR.dom.selection){for(var o=e(n),i=o[0]&&o[0].getAscendant("table"),r=t(o),a=o.length-1;a>=0;a--)d(o[a]);r?u(r,!0):i&&i.remove()}else if(n instanceof CKEDITOR.dom.element){var s=n.getParent();1==s.getChildCount()?s.remove():n.remove()}}function c(e){var t=e.getBogus();t&&t.remove(),e.trim()}function u(e,t){var n=e.getDocument(),o=CKEDITOR.document;CKEDITOR.env.ie&&10==CKEDITOR.env.version&&(o.focus(),n.focus());var i=new CKEDITOR.dom.range(n);i["moveToElementEdit"+(t?"End":"Start")](e)||(i.selectNodeContents(e),i.collapse(t?!1:!0)),i.select(!0)}function p(e,t,n){var o=e[t];if("undefined"==typeof n)return o;for(var i=0;o&&i<o.length;i++){if(n.is&&o[i]==n.$)return i;if(i==n)return new CKEDITOR.dom.element(o[i])}return n.is?-1:null}function m(e,t){for(var n=[],o=0;o<e.length;o++){var i=e[o];n.push(i[t]),i[t].rowSpan>1&&(o+=i[t].rowSpan-1)}return n}function h(t,n,o){var i,r=e(t);if((n?1!=r.length:r.length<2)||(i=t.getCommonAncestor())&&i.type==CKEDITOR.NODE_ELEMENT&&i.is("table"))return!1;var a,s=r[0],l=s.getAscendant("table"),d=CKEDITOR.tools.buildTableMap(l),u=d.length,m=d[0].length,h=s.getParent().$.rowIndex,g=p(d,h,s);if(n){var y;try{var f=parseInt(s.getAttribute("rowspan"),10)||1,E=parseInt(s.getAttribute("colspan"),10)||1;y=d["up"==n?h-f:"down"==n?h+f:h]["left"==n?g-E:"right"==n?g+E:g]}catch(b){return!1}if(!y||s.$==y)return!1;r["up"==n||"left"==n?"unshift":"push"](new CKEDITOR.dom.element(y))}for(var v=s.getDocument(),T=h,C=0,A=0,I=!o&&new CKEDITOR.dom.documentFragment(v),S=0,w=0;w<r.length;w++){a=r[w];var D=a.getParent(),_=a.getFirst(),O=a.$.colSpan,x=a.$.rowSpan,R=D.$.rowIndex,k=p(d,R,a);if(S+=O*x,A=Math.max(A,k-g+O),C=Math.max(C,R-h+x),!o){if(c(a),a.getChildren().count()){if(R!=T&&_&&(!_.isBlockBoundary||!_.isBlockBoundary({br:1}))){var P=I.getLast(CKEDITOR.dom.walker.whitespaces(!0));!P||P.is&&P.is("br")||I.append("br")}a.moveChildren(I)}w?a.remove():a.setHtml("")}T=R}if(o)return C*A==S;I.moveChildren(s),s.appendBogus(),A>=m?s.removeAttribute("rowSpan"):s.$.rowSpan=C,C>=u?s.removeAttribute("colSpan"):s.$.colSpan=A;var N=new CKEDITOR.dom.nodeList(l.$.rows),B=N.count();for(w=B-1;w>=0;w--){var K=N.getItem(w);K.$.cells.length||(K.remove(),B++)}return s}function g(t,n){var o=e(t);if(o.length>1)return!1;if(n)return!0;var i,r,a,s,l=o[0],d=l.getParent(),c=d.getAscendant("table"),u=CKEDITOR.tools.buildTableMap(c),m=d.$.rowIndex,h=p(u,m,l),g=l.$.rowSpan;if(g>1){r=Math.ceil(g/2),a=Math.floor(g/2),s=m+r;var y,f=new CKEDITOR.dom.element(c.$.rows[s]),E=p(u,s);i=l.clone();for(var b=0;b<E.length;b++){if(y=E[b],y.parentNode==f.$&&b>h){i.insertBefore(new CKEDITOR.dom.element(y));break}y=null}y||f.append(i)}else{a=r=1,f=d.clone(),f.insertAfter(d),f.append(i=l.clone());for(var v=p(u,m),T=0;T<v.length;T++)v[T].rowSpan++}return i.appendBogus(),l.$.rowSpan=r,i.$.rowSpan=a,1==r&&l.removeAttribute("rowSpan"),1==a&&i.removeAttribute("rowSpan"),i}function y(t,n){var o=e(t);if(o.length>1)return!1;if(n)return!0;var i,r,a,s=o[0],l=s.getParent(),d=l.getAscendant("table"),c=CKEDITOR.tools.buildTableMap(d),u=l.$.rowIndex,h=p(c,u,s),g=s.$.colSpan;if(g>1)r=Math.ceil(g/2),a=Math.floor(g/2);else{a=r=1;for(var y=m(c,h),f=0;f<y.length;f++)y[f].colSpan++}return i=s.clone(),i.insertAfter(s),i.appendBogus(),s.$.colSpan=r,i.$.colSpan=a,1==r&&s.removeAttribute("colSpan"),1==a&&i.removeAttribute("colSpan"),i}if((CKEDITOR.plugins.get("tabletools")||CKEDITOR.plugins.get("ae_tabletools"))&&!CKEDITOR.plugins.get("ae_tabletools"))return void CKEDITOR.plugins.add("ae_tabletools",{});var f=/^(?:td|th)$/;CKEDITOR.plugins.add("ae_tabletools",{init:function(e){function t(e){return CKEDITOR.tools.extend(e||{},{contextSensitive:1,refresh:function(e,t){this.setState(t.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function i(t,n){var o=e.getCommand(t);o||(o=e.addCommand(t,n),e.addFeature(o))}e.lang.table;i("rowDelete",t({requiredContent:"table",exec:function(e){var t=e.getSelection();u(o(t))}})),i("rowInsertBefore",t({requiredContent:"table",exec:function(e){var t=e.getSelection();n(t,!0)}})),i("rowInsertAfter",t({requiredContent:"table",exec:function(e){var t=e.getSelection();n(t)}})),i("columnDelete",t({requiredContent:"table",exec:function(e){var t=e.getSelection(),n=s(t);n&&u(n,!0)}})),i("columnInsertBefore",t({requiredContent:"table",exec:function(e){var t=e.getSelection();a(t,!0)}})),i("columnInsertAfter",t({requiredContent:"table",exec:function(e){var t=e.getSelection();a(t)}})),i("cellDelete",t({requiredContent:"table",exec:function(e){var t=e.getSelection();d(t)}})),i("cellMerge",t({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(e){u(h(e.getSelection()),!0)}})),i("cellMergeRight",t({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){u(h(e.getSelection(),"right"),!0)}})),i("cellMergeDown",t({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){u(h(e.getSelection(),"down"),!0)}})),i("cellVerticalSplit",t({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){u(g(e.getSelection()))}})),i("cellHorizontalSplit",t({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){u(y(e.getSelection()))}})),i("cellInsertBefore",t({requiredContent:"table",exec:function(e){var t=e.getSelection();l(t,!0)}})),i("cellInsertAfter",t({requiredContent:"table",exec:function(e){var t=e.getSelection();l(t)}}))},getSelectedCells:e})}(),CKEDITOR.tools.buildTableMap=function(e){for(var t=e.$.rows,n=-1,o=[],i=0;i<t.length;i++){n++,!o[n]&&(o[n]=[]);for(var r=-1,a=0;a<t[i].cells.length;a++){var s=t[i].cells[a];for(r++;o[n][r];)r++;for(var l=isNaN(s.colSpan)?1:s.colSpan,d=isNaN(s.rowSpan)?1:s.rowSpan,c=0;d>c;c++){o[n+c]||(o[n+c]=[]);for(var u=0;l>u;u++)o[n+c][r+u]=t[i].cells[a]}r+=l-1}}return o},function(){function t(){}function n(t,n){var i=AlloyEditor.Buttons[t];if(!i){var r=n.name||n.command||t;i=e.createClass(CKEDITOR.tools.merge(o,{displayName:t,propTypes:{editor:e.PropTypes.object.isRequired,tabIndex:e.PropTypes.number},statics:{key:t},render:function(){var t="ae-button ae-button-bridge",o="button-"+r,i="ae-icon-"+r,a={},s=CKEDITOR.skin.getIconStyle(r);if(s){var l=s.split(";");a.backgroundImage=l[0].substring(l[0].indexOf(":")+1),a.backgroundPosition=l[1].substring(l[1].indexOf(":")+1),a.backgroundSize=l[2].substring(l[2].indexOf(":")+1)}return e.createElement("button",{"aria-label":n.label,className:t,"data-type":o,onClick:this._handleClick,tabIndex:this.props.tabIndex,title:n.label},e.createElement("span",{className:i,style:a}))},_handleClick:function(e){var t=this.props.editor.get("nativeEditor");n.onClick?n.onClick.call(this):t.execCommand(n.command),t.fire("actionPerformed",this)}})),AlloyEditor.Buttons[t]=i}return i}if(!CKEDITOR.plugins.get("ae_buttonbridge")){var o={toFeature:t};CKEDITOR.plugins.get("button")||(CKEDITOR.UI_BUTTON="button",CKEDITOR.plugins.add("button",{})),CKEDITOR.plugins.add("ae_buttonbridge",{requires:["ae_uibridge"],init:function(e){e.ui.addButton=function(e,t){this.add(e,CKEDITOR.UI_BUTTON,t)},e.ui.addHandler(CKEDITOR.UI_BUTTON,{add:n,create:function(e){var t="buttonBridge"+(1e9*Math.random()>>>0),o=n(t,e);return new o}})}})}}(),function(){function t(){}if(!CKEDITOR.plugins.get("ae_panelmenubuttonbridge")){var n={createPanel:t},o=function(t,o){var i=AlloyEditor.Buttons[t];if(!i){var r=o.name||o.command||buttonName;i=e.createClass(CKEDITOR.tools.merge(n,{displayName:t,propTypes:{editor:e.PropTypes.object.isRequired},statics:{key:t},render:function(){var t="ae-button ae-button-bridge",n="ae-icon-"+r,i={},a=CKEDITOR.skin.getIconStyle(r);if(a){var s=a.split(";");i.backgroundImage=s[0].substring(s[0].indexOf(":")+1),i.backgroundPosition=s[1].substring(s[1].indexOf(":")+1),i.backgroundSize=s[2].substring(s[2].indexOf(":")+1)}var l;return this.props.expanded&&(l=this._getPanel()),e.createElement("div",{className:"ae-container ae-has-dropdown"},e.createElement("button",{"aria-expanded":this.props.expanded,"aria-label":o.label,className:t,onClick:this.props.toggleDropdown,role:"combobox",tabIndex:this.props.tabIndex,title:o.label},e.createElement("span",{className:n,style:i})),l)},_getPanel:function(){var t={hide:this.props.toggleDropdown,show:this.props.toggleDropdown},n=new CKEDITOR.dom.element("div"),i={element:n,keys:{}};return o.onBlock&&o.onBlock.call(this,t,i),e.createElement(AlloyEditor.ButtonDropdown,{onDismiss:this.props.toggleDropdown},e.createElement("div",{className:n.getAttribute("class"),dangerouslySetInnerHTML:{__html:n.getHtml()}}))}})),AlloyEditor.Buttons[t]=i}return i};CKEDITOR.plugins.get("panelmenubutton")||(CKEDITOR.UI_PANELBUTTON="panelmenubutton",CKEDITOR.plugins.add("panelmenubutton",{})),CKEDITOR.plugins.add("ae_panelmenubuttonbridge",{requires:["ae_uibridge"],init:function(e){e.ui.addPanelMenuButton=function(e,t){this.add(e,CKEDITOR.UI_PANELBUTTON,t)},e.ui.addHandler(CKEDITOR.UI_PANELBUTTON,{add:o,create:function(e){var t="panelMenuButtonBridge"+(1e9*Math.random()>>>0),n=o(t,e);return new n}})}})}}(),function(){function t(){}if(!CKEDITOR.plugins.get("ae_richcombobridge")){var n={commit:t,createPanel:t,disable:t,enable:t,getState:t,hideGroup:t,hideItem:t,mark:t,showAll:t,startGroup:t,unmarkAll:t},o=function(t,o){var i=AlloyEditor.Buttons[t];if(!i){var r={value:void 0};i=e.createClass(CKEDITOR.tools.merge(n,{displayName:t,propTypes:{editor:e.PropTypes.object.isRequired},statics:{key:t},add:function(e,t,n){this._items.push({preview:t,title:n,value:e})},componentWillMount:function(){this._items=[],this.setValue=this._setValue,o.init&&o.init.call(this),o.onRender&&o.onRender.call(this)},componentWillUnmount:function(){this._cacheValue(this.state.value),this.setValue=this._cacheValue},getInitialState:function(){return{value:r.value}},getValue:function(){return this.state.value},render:function(){var t,n=this.state.value||o.label;return this.props.expanded&&(t=this._getItemsList()),e.createElement("div",{className:"ae-container-dropdown ae-has-dropdown"},e.createElement("button",{"aria-expanded":this.props.expanded,"aria-label":n,className:"ae-toolbar-element",onClick:this.props.toggleDropdown,role:"combobox",tabIndex:this.props.tabIndex,title:n},e.createElement("div",{className:"ae-container"},e.createElement("span",{className:"ae-container-dropdown-selected-item"},n),e.createElement("span",{className:"ae-icon-arrow"}))),t)},_cacheValue:function(e){r.value=e},_getItems:function(){var t=this,n=this._items.map(function(n){return e.createElement("li",{key:n.title,role:"option"},e.createElement("button",{className:"ae-toolbar-element",dangerouslySetInnerHTML:{__html:n.preview},"data-value":n.value,onClick:t._onClick}))});return n},_getItemsList:function(){return e.createElement(AlloyEditor.ButtonDropdown,{onDismiss:this.props.toggleDropdown},this._getItems())},_onClick:function(e){var t=this.props.editor.get("nativeEditor");o.onClick&&(o.onClick.call(this,e.currentTarget.getAttribute("data-value")),t.fire("actionPerformed",this))},_setValue:function(e){this.setState({value:e})}})),AlloyEditor.Buttons[t]=i}return i};CKEDITOR.plugins.get("richcombo")||(CKEDITOR.UI_RICHCOMBO="richcombo",CKEDITOR.plugins.add("richcombo",{})),CKEDITOR.plugins.add("ae_richcombobridge",{requires:["ae_uibridge"],init:function(e){e.ui.addRichCombo=function(e,t){this.add(e,CKEDITOR.UI_RICHCOMBO,t)},e.ui.addHandler(CKEDITOR.UI_RICHCOMBO,{add:o,create:function(e){var t="richComboBridge"+(1e9*Math.random()>>>0),n=o(t,e);return new n}})}})}}(),function(){CKEDITOR.plugins.add("ae_uibridge",{beforeInit:function(e){var t=e.ui.add;e.ui.add=function(e,n,o){t.apply(this,arguments);var i=this._.handlers[n];i&&i.add&&i.add(e,o)}}})}(),function(){var e={isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isFunction:function(e){return"function"==typeof e},isNull:function(e){return null===e},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isObject:function(t){var n=typeof t;return t&&("object"===n||e.isFunction(t))},isString:function(e){return"string"==typeof e},mix:function(e,t){var n=Object.prototype.hasOwnProperty;for(var o in t)n.call(t,o)&&(e[o]=t[o])},toInt:function(e){return parseInt(e,10)}};AlloyEditor.Lang=e}(),function(){var e={extend:function(e,t,n,o){if(!t||!e)throw"extend failed, verify dependencies";var i=t.prototype,r=Object.create(i);return e.prototype=r,r.constructor=e,e.superclass=i,t!==Object&&i.constructor===Object.prototype.constructor&&(i.constructor=t),n&&AlloyEditor.Lang.mix(r,n),o&&AlloyEditor.Lang.mix(e,o),e}};AlloyEditor.OOP=e}(),function(){function e(e){this.__config__=e||{},this.__ATTRS__={}}e.prototype={constructor:e,get:function(e){var t=this.constructor.ATTRS[e];if(t){this._isInitialized(e)||this._init(e);var n=this.__ATTRS__[e];return t.getter&&(n=this._callStringOrFunction(t.getter,n)),n}},set:function(e,t){var n=this.constructor.ATTRS[e];n&&(this._isInitialized(e)||this._init(e),n.readOnly||n.writeOnce&&this._isInitialized(e)||(!n.validator||this._callStringOrFunction(n.validator,t))&&(n.setter&&(t=this._callStringOrFunction(n.setter,t)),this.__ATTRS__[e]=t))},_callStringOrFunction:function(e,t){var n=null;return AlloyEditor.Lang.isArray(t)||(t=[t]),AlloyEditor.Lang.isString(e)&&AlloyEditor.Lang.isFunction(this[e])?n=this[e].apply(this,t):AlloyEditor.Lang.isFunction(e)&&(n=e.apply(this,t)),n},_init:function(e){var t,n=this.constructor.ATTRS[e],o=Object.prototype.hasOwnProperty.call(n,"value"),i=Object.prototype.hasOwnProperty.call(this.__config__,e);if(n.valueFn)t=this._callStringOrFunction(n.valueFn,t),this.__ATTRS__[e]=t;else if(n.readOnly)t=n.value;else if(n.writeOnce)if(i)t=this.__config__[e];else{if(!o)return;t=n.value}else i?t=this.__config__[e]:o&&(t=n.value);if(n.validator&&i&&!this._callStringOrFunction(n.validator,t)){if(!o)return;t=n.value}n.setter&&i&&(t=this._callStringOrFunction(n.setter,t)),this.__ATTRS__[e]=t},_isInitialized:function(e){return Object.prototype.hasOwnProperty.call(this.__ATTRS__,e)}},AlloyEditor.Attribute=e}(),function(){function e(t){e.superclass.constructor.call(this,t),this.init(t)}AlloyEditor.OOP.extend(e,AlloyEditor.Attribute,{init:function(e){this._callChain("initializer",e)},destroy:function(){this._callChain("destructor")},_callChain:function(e,t){for(var n=[],o=this.constructor;o;)AlloyEditor.Lang.isFunction(o.prototype[e])&&n.push(o.prototype[e]),o=o.superclass?o.superclass.constructor:null;n=n.reverse(),t=AlloyEditor.Lang.isArray(t)?t:[t];for(var i=0;i<n.length;i++){var r=n[i];r.apply(this,t)}}}),AlloyEditor.Base=e}(),function(){var e=function(){return"ae-arrow-box ae-arrow-box-bottom"};AlloyEditor.SelectionGetArrowBoxClasses={table:e}}(),function(){var e={left:0,top:0},n=function(n,o){var i=t.findDOMNode(n),r=i.offsetWidth/2,a=new CKEDITOR.dom.window(window).getScrollPosition(),s=n.props.gutter||e,l=n.getWidgetXYPoint(o.left+o.width/2-a.x,o.top+a.y,CKEDITOR.SELECTION_BOTTOM_TO_TOP);n.moveToPoint([l[0],l[1]],[o.left+o.width/2-r-a.x,o.top-i.offsetHeight+a.y-s.top])},o=function(e){return n(this,e.selectionData.element.getClientRect()),!0},i=function(e){var t=e.editor.get("nativeEditor"),o=new CKEDITOR.Table(t).getFromSelection();return n(this,o.getClientRect()),!0};AlloyEditor.SelectionSetPosition={image:o,table:i}}(),function(){var e=function(e){var t,n=e.editor.get("nativeEditor");return!(n.isSelectionEmpty()||!(t=new CKEDITOR.Link(n).getFromSelection())||t.isReadOnly())},t=function(e){var t=e.data.selectionData;return!(!t.element||"img"!==t.element.getName()||t.element.isReadOnly())},n=function(e){var t=e.editor.get("nativeEditor"),n=t.isSelectionEmpty(),o=e.data.selectionData;return!(o.element||!o.region||n||t.getSelection().getCommonAncestor().isReadOnly())},o=function(e){var t=e.editor.get("nativeEditor"),n=new CKEDITOR.Table(t),o=n.getFromSelection();return!(!o||!n.isEditable(o))};AlloyEditor.SelectionTest={image:t,link:e,table:o,text:n}}(),function(){var e=[{name:"link",buttons:["linkEdit"],test:AlloyEditor.SelectionTest.link},{name:"image",buttons:["imageLeft","imageCenter","imageRight"],setPosition:AlloyEditor.SelectionSetPosition.image,test:AlloyEditor.SelectionTest.image},{name:"text",buttons:["styles","bold","italic","underline","link","twitter"],test:AlloyEditor.SelectionTest.text},{name:"table",buttons:["tableHeading","tableRow","tableColumn","tableCell","tableRemove"],getArrowBoxClasses:AlloyEditor.SelectionGetArrowBoxClasses.table,setPosition:AlloyEditor.SelectionSetPosition.table,test:AlloyEditor.SelectionTest.table}];AlloyEditor.Selections=e}(),function(){function n(e){n.superclass.constructor.call(this,e)}AlloyEditor.OOP.extend(n,AlloyEditor.Base,{initializer:function(e){var t=this.get("srcNode");this.get("enableContentEditable")&&t.setAttribute("contenteditable","true");var n=CKEDITOR.inline(t);n.config.allowedContent=this.get("allowedContent"),n.config.toolbars=this.get("toolbars"),n.config.removePlugins=this.get("removePlugins"),n.config.extraPlugins=this.get("extraPlugins"),n.config.placeholderClass=this.get("placeholderClass"),n.config.pasteFromWordRemoveStyles=!1,n.config.pasteFromWordRemoveFontStyles=!1,AlloyEditor.Lang.mix(n.config,e),n.once("contentDom",function(){n.editable().addClass("ae-editable")}),AlloyEditor.loadLanguageResources(this._renderUI.bind(this)),this._editor=n},destructor:function(){this._editorUIElement&&(t.unmountComponentAtNode(this._editorUIElement),this._editorUIElement.parentNode.removeChild(this._editorUIElement));var e=this.get("nativeEditor");if(e){var n=e.editable();n&&(n.removeClass("ae-editable"),this.get("enableContentEditable")&&this.get("srcNode").setAttribute("contenteditable","false")),e.destroy()}},_getNativeEditor:function(){return this._editor},_renderUI:function(){var n=document.createElement("div");n.className="ae-ui";var o=this.get("uiNode")||document.body;o.appendChild(n),this._mainUI=t.render(e.createElement(AlloyEditor.UI,{editor:this,eventsDelay:this.get("eventsDelay"),toolbars:this.get("toolbars")}),n),this._editorUIElement=n,this.get("nativeEditor").fire("uiReady")},_toElement:function(e){return AlloyEditor.Lang.isString(e)&&(e=document.getElementById(e)),e},_validateAllowedContent:function(e){return AlloyEditor.Lang.isString(e)||AlloyEditor.Lang.isObject(e)||AlloyEditor.Lang.isBoolean(e)},_validateToolbars:function(e){return AlloyEditor.Lang.isObject(e)||AlloyEditor.Lang.isNull(e)}},{ATTRS:{allowedContent:{validator:"_validateAllowedContent",value:!0,writeOnce:!0},enableContentEditable:{validator:AlloyEditor.Lang.isBoolean,value:!0,writeOnce:!0},eventsDelay:{validator:AlloyEditor.Lang.isNumber,value:100},extraPlugins:{validator:AlloyEditor.Lang.isString,value:"ae_uicore,ae_selectionregion,ae_dragresize,ae_addimages,ae_placeholder,ae_tabletools,ae_tableresize,ae_autolink",writeOnce:!0},nativeEditor:{getter:"_getNativeEditor",readOnly:!0},placeholderClass:{validator:AlloyEditor.Lang.isString,value:"ae-placeholder",writeOnce:!0},removePlugins:{validator:AlloyEditor.Lang.isString,value:"contextmenu,toolbar,elementspath,resize,liststyle,link",writeOnce:!0},srcNode:{setter:"_toElement",writeOnce:!0},toolbars:{validator:"_validateToolbars",value:{add:{buttons:["image","camera","hline","table"],tabIndex:2},styles:{selections:AlloyEditor.Selections,tabIndex:1}}},uiNode:{setter:"_toElement",writeOnce:!0}}}),CKEDITOR.event.implementOn(n),AlloyEditor.Core=n}(),function(){var e={applyStyle:function(){if(AlloyEditor.Lang.isFunction(this.isActive)&&AlloyEditor.Lang.isFunction(this.getStyle)){var e=this.props.editor.get("nativeEditor");e.getSelection().lock(),this.isActive()?e.removeStyle(this.getStyle()):e.applyStyle(this.getStyle()),e.getSelection().unlock(),e.fire("actionPerformed",this)}}};AlloyEditor.ButtonActionStyle=e}(),function(){var t={propTypes:{command:e.PropTypes.string.isRequired,modifiesSelection:e.PropTypes.bool},execCommand:function(e){var t=this.props.editor.get("nativeEditor");t.execCommand(this.props.command,e),this.props.modifiesSelection&&t.selectionChange(!0),t.fire("actionPerformed",this)}};AlloyEditor.ButtonCommand=t}(),function(){var e={getStateClasses:function(){var e="";return AlloyEditor.Lang.isFunction(this.isActive)&&this.isActive()&&(e+="ae-button-pressed"),AlloyEditor.Lang.isFunction(this.isDisabled)&&this.isDisabled()&&(e+=" ae-button-disabled"),e}};AlloyEditor.ButtonStateClasses=e}(),function(){var t={propTypes:{style:e.PropTypes.object},componentWillMount:function(){this._style=new CKEDITOR.style(this.props.style)},componentWillUnmount:function(){this._style=null},getStyle:function(){return this._style},isActive:function(){var e,t=this.props.editor.get("nativeEditor"),n=t.elementPath();return e=this.getStyle().checkActive(n,t)}};AlloyEditor.ButtonStyle=t}(),function(){var t={getToolbarButtons:function(t,n){var o={},i=this.filterExclusive(t.filter(function(e){return e&&(AlloyEditor.Buttons[e]||AlloyEditor.Buttons[e.name])}).map(function(e){return AlloyEditor.Lang.isString(e)?e=AlloyEditor.Buttons[e]:AlloyEditor.Lang.isString(e.name)&&(o[AlloyEditor.Buttons[e.name].key]=e.cfg,e=AlloyEditor.Buttons[e.name]),e})).map(function(t){var i=this.mergeExclusiveProps({editor:this.props.editor,key:t.key,tabKey:t.key,tabIndex:this.props.trigger&&this.props.trigger.props.tabKey===t.key?0:-1,trigger:this.props.trigger},t.key);return i=this.mergeDropdownProps(i,t.key),n&&(i=CKEDITOR.tools.merge(i,n,o[t.key])),e.createElement(t,i)},this);return i}};AlloyEditor.ToolbarButtons=t}(),function(){var e={getArrowBoxClasses:function(){var e="ae-arrow-box";return AlloyEditor.Lang.isFunction(this.getInteractionPoint)&&this.getInteractionPoint()&&(e+=this.getInteractionPoint().direction===CKEDITOR.SELECTION_TOP_TO_BOTTOM?" ae-arrow-box-top":" ae-arrow-box-bottom"),e}};AlloyEditor.WidgetArrowBox=e}(),function(){var e={componentWillReceiveProps:function(e){this.setState({dropdownTrigger:null,itemDropdown:null})},getInitialState:function(){return{dropdownTrigger:null,itemDropdown:null}},mergeDropdownProps:function(e,t){return CKEDITOR.tools.merge(e,{expanded:this.state.itemDropdown===t?!0:!1,tabIndex:this.state.dropdownTrigger===t?0:-1,toggleDropdown:this.toggleDropdown.bind(this,t)})},toggleDropdown:function(e,n){this.setState({dropdownTrigger:e,itemDropdown:e!==this.state.itemDropdown?e:null},function(){this.state.itemDropdown||(this.moveFocus?this.moveFocus(n):t.findDOMNode(this).focus())})}};AlloyEditor.WidgetDropdown=e}(),function(){var e={cancelExclusive:function(e){this.state.itemExclusive===e&&this.setState({itemExclusive:null})},componentWillReceiveProps:function(e){this.setState({itemExclusive:null})},filterExclusive:function(e){return e.filter(function(e){return this.state.itemExclusive?this.state.itemExclusive===e.key?e:void 0:e}.bind(this))},mergeExclusiveProps:function(e,t){return CKEDITOR.tools.merge(e,{cancelExclusive:this.cancelExclusive.bind(this,t),renderExclusive:this.state.itemExclusive===t,requestExclusive:this.requestExclusive.bind(this,t)})},requestExclusive:function(e){this.setState({itemExclusive:e})}};AlloyEditor.WidgetExclusive=e}(),function(){var n=0,o=1,i=-1,r=0,a=1,s=2,l={propTypes:{onDismiss:e.PropTypes.func,circular:e.PropTypes.bool.isRequired,descendants:e.PropTypes.string.isRequired,keys:e.PropTypes.object.isRequired},componentDidMount:function(){this._refresh()},componentDidUpdate:function(){this._refresh()},focus:function(e){(!e||this._isValidTarget(e.target))&&this._descendants&&(this._descendants[this._activeDescendant].focus(),e&&(e.stopPropagation(),e.preventDefault()))},handleKey:function(e){if(this._isValidTarget(e.target)&&this._descendants){var t=this._getFocusAction(e);t.type&&(e.stopPropagation(),e.preventDefault(),t.type===a&&this._moveFocus(t.direction),t.type===s&&this.props.onDismiss(t.direction))}},moveFocus:function(e){e=AlloyEditor.Lang.isNumber(e)?e:0,this._moveFocus(e)},_getFocusAction:function(e){var t={type:r};if(this.props.keys){var n=this._getFocusMoveDirection(e);n&&(t.direction=n,t.type=a);var o=this._getFocusDismissAction(e,n);o.dismiss&&(t.direction=o.direction,t.type=s)}return t},_getFocusDismissAction:function(e,t){var n={direction:t,dismiss:!1};return this.props.onDismiss&&(this._isValidKey(e.keyCode,this.props.keys.dismiss)&&(n.dismiss=!0),this._isValidKey(e.keyCode,this.props.keys.dismissNext)&&(n.dismiss=!0,n.direction=o),this._isValidKey(e.keyCode,this.props.keys.dismissPrev)&&(n.dismiss=!0,n.direction=i),n.dismiss||this.props.circular||!t||(n.dismiss=t===i&&0===this._activeDescendant||t===o&&this._activeDescendant===this._descendants.length-1)),n},_getFocusMoveDirection:function(e){var t=n;return this._isValidKey(e.keyCode,this.props.keys.next)&&(t=o),this._isValidKey(e.keyCode,this.props.keys.prev)&&(t=i),e.shifKey&&(t*=-1),t},_isValidKey:function(e,t){return AlloyEditor.Lang.isArray(t)?-1!==t.indexOf(e):e===t},_isValidTarget:function(e){var t=e.tagName.toLowerCase();return"input"!==t&&"select"!==t&&"textarea"!==t},_moveFocus:function(e){var t=this._descendants.length,n=this._descendants[this._activeDescendant];n.setAttribute("tabIndex",-1),this._activeDescendant+=e,this.props.circular?this._activeDescendant=(this._activeDescendant%t+t)%t:this._activeDescendant=Math.max(Math.min(this._activeDescendant,t-1),0),n=this._descendants[this._activeDescendant],n.setAttribute("tabIndex",0),n.focus()},_refresh:function(){var e=t.findDOMNode(this);if(e){var n=e.querySelectorAll(this.props.descendants),o=[];this._descendants=[],Array.prototype.slice.call(n).forEach(function(e){var t=e.getAttribute("data-tabindex");t?o.push(e):this._descendants.push(e)}.bind(this)),o=o.sort(function(e,t){return AlloyEditor.Lang.toInt(e.getAttribute("data-tabindex"))>AlloyEditor.Lang.toInt(t.getAttribute("data-tabindex"))}),this._descendants=o.concat(this._descendants),this._activeDescendant=0,this._descendants.some(function(e,t){return"0"===e.getAttribute("tabindex")?(this._activeDescendant=t,this.focus(),!0):void 0}.bind(this))}}};AlloyEditor.WidgetFocusManager=l}(),function(){var t={propTypes:{editorEvent:e.PropTypes.object},getInteractionPoint:function(){var e=this.props.editorEvent?this.props.editorEvent.data:null;if(e){var t=e.selectionData,n={x:e.nativeEvent.pageX,y:e.nativeEvent.pageY},o=t.region.direction,i=t.region.endRect,r=t.region.startRect;i&&r&&r.top===i.top&&(o=CKEDITOR.SELECTION_BOTTOM_TO_TOP);var a,s;return n.x&&n.y?(a=this._getXPoint(t,n.x),s=o===CKEDITOR.SELECTION_BOTTOM_TO_TOP?Math.min(n.y,t.region.top):Math.max(n.y,t.region.bottom)):(a=t.region.left+t.region.width/2,s=o===CKEDITOR.SELECTION_TOP_TO_BOTTOM?t.region.bottom:t.region.top),{direction:o,x:a,y:s}}},_getXPoint:function(e,t){var n,o=e.region,i=o.startRect?o.startRect.left:o.left,r=o.endRect?o.endRect.right:o.right;if(t>i&&r>t)n=t;else{var a=Math.abs(i-t),s=Math.abs(r-t);n=s>a?i:r}return n}};AlloyEditor.WidgetInteractionPoint=t}(),function(){var n={mixins:[AlloyEditor.WidgetInteractionPoint],propTypes:{constrainToViewport:e.PropTypes.bool,gutter:e.PropTypes.object},getDefaultProps:function(){return{gutter:{left:0,top:10},constrainToViewport:!0}},cancelAnimation:function(){window.cancelAnimationFrame&&window.cancelAnimationFrame(this._animationFrameId)},getConstrainedPosition:function(e,t){t=t||new CKEDITOR.dom.window(window).getViewPaneSize();var n=e.left,o=e.top;return e.left+e.width>t.width&&(n-=e.left+e.width-t.width),0>o&&(o=0),{x:n,y:o}},getWidgetXYPoint:function(e,n,o){var i=t.findDOMNode(this),r=this.props.gutter;return o===CKEDITOR.SELECTION_TOP_TO_BOTTOM||o===CKEDITOR.SELECTION_BOTTOM_TO_TOP?(e=e-r.left-i.offsetWidth/2,n=o===CKEDITOR.SELECTION_TOP_TO_BOTTOM?n+r.top:n-i.offsetHeight-r.top):(o===CKEDITOR.SELECTION_LEFT_TO_RIGHT||o===CKEDITOR.SELECTION_RIGHT_TO_LEFT)&&(e=o===CKEDITOR.SELECTION_LEFT_TO_RIGHT?e+r.left+i.offsetHeight/2:e-3*i.offsetHeight/2-r.left,n=n-r.top-i.offsetHeight/2),0>e&&(e=0),0>n&&(n=0),[e,n]},isVisible:function(){var e=t.findDOMNode(this);if(e){var n=new CKEDITOR.dom.element(e);return n.hasClass("alloy-editor-visible")}return!1},moveToPoint:function(e,n){var o=new CKEDITOR.dom.element(t.findDOMNode(this));o.setStyles({left:e[0]+"px",top:e[1]+"px",opacity:0}),o.removeClass("alloy-editor-invisible"),this._animate(function(){o.addClass("ae-toolbar-transition"),o.addClass("alloy-editor-visible"),o.setStyles({left:n[0]+"px",top:n[1]+"px",opacity:1})})},show:function(){var e=t.findDOMNode(this);if(!this.isVisible()&&e){var n=this.getInteractionPoint();if(n){var o,i,r,a,s=new CKEDITOR.dom.element(e);if(o=r=parseFloat(s.getStyle("left")),i=a=parseFloat(s.getStyle("top")),this.props.constrainToViewport){var l=this.getConstrainedPosition({height:parseFloat(e.offsetHeight),left:o,top:i,width:parseFloat(e.offsetWidth)});o=l.x,i=l.y}a=n.direction===CKEDITOR.SELECTION_TOP_TO_BOTTOM?this.props.selectionData.region.bottom:this.props.selectionData.region.top,this.moveToPoint([r,a],[o,i])}}},updatePosition:function(){var e=this.getInteractionPoint(),n=t.findDOMNode(this);if(e&&n){var o=this.getWidgetXYPoint(e.x,e.y,e.direction);new CKEDITOR.dom.element(n).setStyles({left:o[0]+"px",top:o[1]+"px"})}},_animate:function(e){window.requestAnimationFrame?this._animationFrameId=window.requestAnimationFrame(e):e()}};AlloyEditor.WidgetPosition=n}(),function(){var t=e.createClass({displayName:"ButtonBold",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"bold"},getDefaultProps:function(){return{command:"bold",style:{element:"strong"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.bold,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-bold",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.bold},e.createElement("span",{className:"ae-icon-bold"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonBold=t}(),function(){var n=e.createClass({displayName:"ButtonCameraImage",statics:{key:"cameraImage"},getDefaultProps:function(){return{videoWidth:320}},componentDidMount:function(){t.findDOMNode(this.refs.buttonTakePhoto).focus()},componentWillUnmount:function(){this._stream&&(this._stream.stop(),this._stream=null)},render:function(){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t.call(navigator,{video:!0,audio:!1},this._handleStreamSuccess,this._handleStreamError),e.createElement("div",{className:"ae-camera"},e.createElement("video",{ref:"videoContainer"},"Video stream not available."),e.createElement("button",{className:"ae-camera-shoot",onClick:this.takePhoto,ref:"buttonTakePhoto"},"Take photo"),e.createElement("canvas",{className:"ae-camera-canvas",ref:"canvasContainer"}))},takePhoto:function(){var e=t.findDOMNode(this.refs.videoContainer),n=t.findDOMNode(this.refs.canvasContainer),o=n.getContext("2d"),i=this._videoHeight,r=this.props.videoWidth;if(r&&i){n.width=r,n.height=i,o.drawImage(e,0,0,r,i);var a=n.toDataURL("image/png"),s=CKEDITOR.dom.element.createFromHtml('<img src="'+a+'">'),l=this.props.editor.get("nativeEditor");l.insertElement(s),this.props.cancelExclusive(),l.fire("actionPerformed",this),l.fire("imageCameraAdd",s);
}},_handleStreamError:function(e){window.alert("An error occurred! "+e)},_handleStreamSuccess:function(e){var n=t.findDOMNode(this.refs.videoContainer),o=t.findDOMNode(this.refs.canvasContainer);n.addEventListener("canplay",function(e){var t=n.videoHeight/(n.videoWidth/this.props.videoWidth);isNaN(t)&&(t=this.props.videoWidth/(4/3)),n.setAttribute("width",this.props.videoWidth),n.setAttribute("height",t),o.setAttribute("width",this.props.videoWidth),o.setAttribute("height",t),this._videoHeight=t}.bind(this),!1),this._stream=e,navigator.mozGetUserMedia?n.mozSrcObject=e:n.src=(window.URL||window.webkitURL).createObjectURL(e),n.play(),t.findDOMNode(this.refs.buttonTakePhoto).disabled=!1}});AlloyEditor.ButtonCameraImage=n}(),function(){var t=e.createClass({displayName:"ButtonCamera",propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"camera"},render:function(){if(this.props.renderExclusive)return e.createElement(AlloyEditor.ButtonCameraImage,this.props);var n=!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);return e.createElement("button",{"aria-label":AlloyEditor.Strings.camera,className:"ae-button","data-type":"button-image-camera",disabled:n,onClick:this.props.requestExclusive.bind(t.key),tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.camera},e.createElement("span",{className:"ae-icon-camera"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonCamera=t}(),function(){var t=e.createClass({displayName:"ButtonCode",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"code"},getDefaultProps:function(){return{style:{element:"pre"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.code,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-code",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.code},e.createElement("span",{className:"ae-icon-code"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonCode=t}(),function(){var t=e.createClass({displayName:"ButtonCommandListItem",mixins:[AlloyEditor.ButtonCommand],propTypes:{description:e.PropTypes.string.isRequired,icon:e.PropTypes.string},statics:{key:"buttonCommandListItem"},render:function(){return e.createElement("button",{"aria-label":this.props.description,className:this._getClassName(),onClick:this.execCommand,tabIndex:this.props.tabIndex},this.props.description)},_getClassName:function(){var e="ae-toolbar-element";return this.props.icon&&(e+=" ae-icon-"+this.props.icon),e}});AlloyEditor.ButtonCommandListItem=t}(),function(){var n=e.createClass({displayName:"ButtonCommandsList",mixins:[AlloyEditor.WidgetFocusManager],propTypes:{commands:e.PropTypes.arrayOf(e.PropTypes.object),editor:e.PropTypes.object.isRequired,listId:e.PropTypes.string},statics:{key:"buttonCommandsList"},componentDidMount:function(){t.findDOMNode(this).focus()},getDefaultProps:function(){return{circular:!1,descendants:".ae-toolbar-element",keys:{dismiss:[27],dismissNext:[39],dismissPrev:[37],next:[40],prev:[38]}}},render:function(){return e.createElement("div",{className:"ae-dropdown ae-arrow-box ae-arrow-box-top-left",onFocus:this.focus,onKeyDown:this.handleKey,tabIndex:"0"},e.createElement("ul",{className:"ae-listbox",id:this.props.listId,role:"listbox"},this._renderActions(this.props.commands)))},_renderActions:function(t){var n,o=this.props.editor;return t&&t.length&&(n=t.map(function(t){return e.createElement("li",{key:t.command,role:"option"},e.createElement(AlloyEditor.ButtonCommandListItem,{command:t.command,description:"string"==typeof t.label?t.label:t.label(),editor:o}))})),n}});AlloyEditor.ButtonCommandsList=n}(),function(){var t=e.createClass({displayName:"ButtonDropdown",mixins:[AlloyEditor.WidgetFocusManager],getDefaultProps:function(){return{circular:!1,descendants:".ae-toolbar-element",keys:{dismiss:[27],dismissNext:[39],dismissPrev:[37],next:[40],prev:[38]}}},statics:{key:"dropdown"},render:function(){return e.createElement("div",{className:"ae-dropdown ae-arrow-box ae-arrow-box-top-left",onFocus:this.focus,onKeyDown:this.handleKey,tabIndex:"0"},e.createElement("ul",{className:"ae-listbox",role:"listbox"},this.props.children))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonDropdown=t}(),function(){var t=e.createClass({displayName:"ButtonH1",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"h1"},getDefaultProps:function(){return{style:{element:"h1"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.h1,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-h1",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.h1},e.createElement("span",{className:"ae-icon-h1"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonH1=t}(),function(){var t=e.createClass({displayName:"ButtonH2",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"h2"},getDefaultProps:function(){return{style:{element:"h2"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.h2,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-h2",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.h2},e.createElement("span",{className:"ae-icon-h2"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonH2=t}(),function(){var t=e.createClass({displayName:"ButtonHline",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"hline"},getDefaultProps:function(){return{command:"horizontalrule",style:{element:"hr"}}},render:function(){return e.createElement("button",{"aria-label":AlloyEditor.Strings.horizontalrule,className:"ae-button","data-type":"button-hline",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.horizontalrule},e.createElement("span",{className:"ae-icon-separator"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonHline=t}(),function(){var t=e.createClass({displayName:"ButtonImageAlignCenter",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"imageCenter"},getDefaultProps:function(){return{style:{element:"img",styles:{display:"block","margin-left":"50%",transform:"translateX(-50%)","-ms-transform":"translateX(-50%)"}}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.alignCenter,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-image-align-center",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.alignCenter},e.createElement("span",{className:"ae-icon-align-center"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonImageAlignCenter=t}(),function(){var t=e.createClass({displayName:"ButtonImageAlignLeft",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"imageLeft"},getDefaultProps:function(){return{style:{element:"img",styles:{"float":"left"}}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.alignLeft,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-image-align-left",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.alignLeft},e.createElement("span",{className:"ae-icon-align-left"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonImageAlignLeft=t}(),function(){var t=e.createClass({displayName:"ButtonImageAlignRight",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"imageRight"},getDefaultProps:function(){return{style:{element:"img",styles:{"float":"right"}}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.alignRight,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-image-align-right",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.alignRight},e.createElement("span",{className:"ae-icon-align-right"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonImageAlignRight=t}(),function(){var n=e.createClass({displayName:"ButtonImage",propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"image"},render:function(){var t={display:"none"};return e.createElement("div",null,e.createElement("button",{"aria-label":AlloyEditor.Strings.image,className:"ae-button","data-type":"button-image",onClick:this.handleClick,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.image},e.createElement("span",{className:"ae-icon-image"})),e.createElement("input",{onChange:this._onInputChange,ref:"fileInput",style:t,type:"file"}))},handleClick:function(e){t.findDOMNode(this.refs.fileInput).click()},_onInputChange:function(){var e=new FileReader,n=t.findDOMNode(this.refs.fileInput);e.onload=function(e){var t=this.props.editor.get("nativeEditor"),o=CKEDITOR.dom.element.createFromHtml('<img src="'+e.target.result+'">');t.insertElement(o),t.fire("actionPerformed",this);var i={el:o,file:n.files[0]};t.fire("imageAdd",i)}.bind(this),e.readAsDataURL(n.files[0]),n.value=""}});AlloyEditor.Buttons[n.key]=AlloyEditor.ButtonImage=n}(),function(){var t=e.createClass({displayName:"ButtonItalic",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"italic"},getDefaultProps:function(){return{command:"italic",style:{element:"em"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.italic,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-italic",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.italic},e.createElement("span",{className:"ae-icon-italic"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonItalic=t}(),function(){var n=13,o=27,i=e.createClass({displayName:"ButtonLinkEdit",statics:{key:"linkEdit"},componentDidMount:function(){window.requestAnimationFrame?window.requestAnimationFrame(this._focusLinkInput):setTimeout(this._focusLinkInput,0)},getInitialState:function(){var e=new CKEDITOR.Link(this.props.editor.get("nativeEditor")).getFromSelection(),t=e?e.getAttribute("href"):"";return{element:e,linkHref:t}},render:function(){var t={opacity:this.state.linkHref?1:0};return e.createElement("div",{className:"ae-container-edit-link"},e.createElement("button",{"aria-label":AlloyEditor.Strings.removeLink,className:"ae-button",disabled:!this.state.element,onClick:this._removeLink,title:AlloyEditor.Strings.remove},e.createElement("span",{className:"ae-icon-unlink"})),e.createElement("div",{className:"ae-container-input"},e.createElement("input",{className:"ae-input",onChange:this._handleLinkChange,onKeyDown:this._handleKeyDown,placeholder:AlloyEditor.Strings.editLink,ref:"linkInput",type:"text",value:this.state.linkHref}),e.createElement("button",{"aria-label":AlloyEditor.Strings.clearInput,className:"ae-button ae-icon-remove",onClick:this._clearLink,style:t,title:AlloyEditor.Strings.clear})),e.createElement("button",{"aria-label":AlloyEditor.Strings.confirm,className:"ae-button",disabled:!this.state.linkHref,onClick:this._updateLink,title:AlloyEditor.Strings.confirm},e.createElement("span",{className:"ae-icon-ok"})))},_clearLink:function(){this.setState({linkHref:""})},_focusLinkInput:function(){t.findDOMNode(this.refs.linkInput).focus()},_handleKeyDown:function(e){(e.keyCode===n||e.keyCode===o)&&e.preventDefault(),e.keyCode===n?this._updateLink():e.keyCode===o&&(this.props.cancelExclusive(),this.props.editor.get("nativeEditor").focus())},_handleLinkChange:function(e){this.setState({linkHref:e.target.value})},_removeLink:function(){var e=this.props.editor.get("nativeEditor"),t=new CKEDITOR.Link(e),n=e.getSelection(),o=n.createBookmarks();t.remove(this.state.element),n.selectBookmarks(o),this.props.cancelExclusive(),e.fire("actionPerformed",this)},_updateLink:function(){var e=this.props.editor.get("nativeEditor"),t=new CKEDITOR.Link(e);this.state.linkHref&&(this.state.element?t.update(this.state.linkHref,this.state.element):t.create(this.state.linkHref),e.fire("actionPerformed",this)),this.props.cancelExclusive()}});AlloyEditor.Buttons[i.key]=AlloyEditor.ButtonLinkEdit=i}(),function(){var t=e.createClass({displayName:"ButtonLink",mixins:[AlloyEditor.ButtonStateClasses],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"link"},isActive:function(){return null!==new CKEDITOR.Link(this.props.editor.get("nativeEditor")).getFromSelection()},render:function(){var n="ae-button "+this.getStateClasses();return this.props.renderExclusive?e.createElement(AlloyEditor.ButtonLinkEdit,this.props):e.createElement("button",{"aria-label":AlloyEditor.Strings.link,className:n,"data-type":"button-link",onClick:this.props.requestExclusive.bind(t.key),tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.link},e.createElement("span",{className:"ae-icon-link"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonLink=t}(),function(){var t=e.createClass({displayName:"ButtonOrderedList",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"ol"},getDefaultProps:function(){return{command:"numberedlist",style:{element:"ol"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.numberedlist,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-ol",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.numberedlist},e.createElement("span",{className:"ae-icon-numbered-list"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonOrderedList=t}(),function(){var t=e.createClass({displayName:"ButtonParagraphAlignLeft",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"paragraphLeft"},getDefaultProps:function(){return{style:{element:"p",styles:{"text-align":"left"}}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.alignLeft,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-paragraph-align-left",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.alignLeft},e.createElement("span",{className:"ae-icon-align-left"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonParagraphAlignLeft=t}(),function(){var t=e.createClass({displayName:"ButtonParagraphAlignRight",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"paragraphRight"},getDefaultProps:function(){return{style:{element:"p",styles:{"text-align":"right"}}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.alignRight,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-paragraph-align-right",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.alignRight},e.createElement("span",{className:"ae-icon-align-right"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonParagraphAlignRight=t}(),function(){var t=e.createClass({displayName:"ButtonParagraphCenter",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"paragraphCenter"},getDefaultProps:function(){return{style:{element:"p",styles:{"text-align":"center"}}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.alignCenter,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-paragraph-center",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.alignCenter},e.createElement("span",{className:"ae-icon-align-center"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonParagraphCenter=t}(),function(){var t=e.createClass({displayName:"ButtonParagraphJustify",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonActionStyle],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"paragraphJustify"},getDefaultProps:function(){return{style:{element:"p",styles:{"text-align":"justify"}}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.alignJustify,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-paragraph-justify",onClick:this.applyStyle,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.alignJustify},e.createElement("span",{className:"ae-icon-align-justified"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonParagraphJustify=t}(),function(){var t=e.createClass({displayName:"ButtonQuote",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"quote"},getDefaultProps:function(){return{command:"blockquote",style:{element:"blockquote"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.quote,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-quote",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.quote},e.createElement("span",{className:"ae-icon-quote"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonQuote=t}(),function(){var t=e.createClass({displayName:"ButtonRemoveFormat",mixins:[AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"removeFormat"},getDefaultProps:function(){return{command:"removeFormat"}},render:function(){return e.createElement("button",{"aria-label":AlloyEditor.Strings.removeformat,className:"ae-button","data-type":"button-removeformat",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.removeformat},e.createElement("span",{className:"ae-icon-removeformat"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonRemoveFormat=t}(),function(){var t=e.createClass({displayName:"ButtonStrike",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"strike"},getDefaultProps:function(){return{command:"strike",style:{element:"s"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.strike,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-strike",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.strike},e.createElement("span",{className:"ae-icon-strike"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonStrike=t}(),function(){var t=e.createClass({displayName:"ButtonsStylesListHeader",render:function(){return this.props.styles&&this.props.styles.length?e.createElement("span",{className:"ae-list-header"},this.props.name):null}});AlloyEditor.ButtonsStylesListHeader=t}(),function(){var t=e.createClass({displayName:"ButtonStylesListItemRemove",propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,removeBlocks:e.PropTypes.array,tabIndex:e.PropTypes.number},statics:{key:"buttonStylesListItemRemove"},getDefaultProps:function(){return{removeBlocks:["h1","h2","h3","h4","h5","h6","pre"]}},render:function(){return e.createElement("li",{role:"option"},e.createElement("button",{className:"ae-toolbar-element",onClick:this._removeStyles,tabIndex:this.props.tabIndex},AlloyEditor.Strings.normal))},_removeStyles:function(){var e=this.props.editor.get("nativeEditor");e.execCommand("removeFormat"),this.props.removeBlocks.forEach(function(t){var n=new CKEDITOR.style({element:t});e.removeStyle(n)}),e.fire("actionPerformed",this)}});AlloyEditor.ButtonStylesListItemRemove=t}(),function(){var t=e.createClass({displayName:"ButtonStylesListItem",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonActionStyle],statics:{key:"buttonStylesListItem"},componentWillMount:function(){var e={element:"span",styles:{margin:0}};e=CKEDITOR.tools.merge(e,this.props.style),this._preview=new CKEDITOR.style(e).buildPreview(this.props.name)},render:function(){return e.createElement("button",{className:"ae-toolbar-element",dangerouslySetInnerHTML:{__html:this._preview},onClick:this._onClick,tabIndex:this.props.tabIndex})},_onClick:function(){this.props.editor.get("nativeEditor").execCommand("removeFormat"),this.applyStyle()}});AlloyEditor.ButtonStylesListItem=t}(),function(){var n=e.createClass({displayName:"ButtonStylesList",mixins:[AlloyEditor.WidgetFocusManager],statics:{key:"buttonStylesList"},componentDidMount:function(){t.findDOMNode(this).focus()},componentWillMount:function(){var e=[],t=[],n=[];this.props.styles.forEach(function(o){var i=new CKEDITOR.style(o.style);i.type===CKEDITOR.STYLE_BLOCK?e.push(o):i.type===CKEDITOR.STYLE_INLINE?t.push(o):i.type===CKEDITOR.STYLE_OBJECT&&n.push(o)}),this._blockStyles=e,this._inlineStyles=t,this._objectStyles=n},getDefaultProps:function(){return{circular:!1,descendants:".ae-toolbar-element",keys:{dismiss:[27],dismissNext:[39],dismissPrev:[37],next:[40],prev:[38]},showRemoveStylesItem:!0}},render:function(){var t;return this.props.showRemoveStylesItem&&(t=e.createElement(AlloyEditor.ButtonStylesListItemRemove,{editor:this.props.editor})),e.createElement("div",{className:"ae-dropdown ae-arrow-box ae-arrow-box-top-left",onFocus:this.focus,onKeyDown:this.handleKey,tabIndex:"0"},e.createElement("ul",{className:"ae-listbox",role:"listbox"},t,e.createElement(AlloyEditor.ButtonsStylesListHeader,{name:AlloyEditor.Strings.blockStyles,styles:this._blockStyles}),this._renderStylesItems(this._blockStyles),e.createElement(AlloyEditor.ButtonsStylesListHeader,{name:AlloyEditor.Strings.inlineStyles,styles:this._inlineStyles}),this._renderStylesItems(this._inlineStyles),e.createElement(AlloyEditor.ButtonsStylesListHeader,{name:AlloyEditor.Strings.objectStyles,styles:this._objectStyles}),this._renderStylesItems(this._objectStyles)))},_renderStylesItems:function(t){var n,o=this.props.editor;return t&&t.length&&(n=t.map(function(t){return e.createElement("li",{key:t.name,role:"option"},e.createElement(AlloyEditor.ButtonStylesListItem,{editor:o,name:t.name,style:t.style}))})),n}});AlloyEditor.ButtonStylesList=n}(),function(){var t=e.createClass({displayName:"ButtonStyles",propTypes:{editor:e.PropTypes.object.isRequired,expanded:e.PropTypes.bool,label:e.PropTypes.string,showRemoveStylesItem:e.PropTypes.bool,styles:e.PropTypes.arrayOf(e.PropTypes.object),tabIndex:e.PropTypes.number,toggleDropdown:e.PropTypes.func},statics:{key:"styles"},render:function(){var t=AlloyEditor.Strings.normal,n=this._getStyles();n.forEach(function(e){this._checkActive(e.style)&&(t=e.name)}.bind(this));var o;return this.props.expanded&&(o=e.createElement(AlloyEditor.ButtonStylesList,{editor:this.props.editor,onDismiss:this.props.toggleDropdown,showRemoveStylesItem:this.props.showRemoveStylesItem,styles:n})),e.createElement("div",{className:"ae-container-dropdown ae-has-dropdown"},e.createElement("button",{"aria-expanded":this.props.expanded,"aria-label":AlloyEditor.Strings.styles+" "+t,className:"ae-toolbar-element",onClick:this.props.toggleDropdown,role:"combobox",tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.styles+" "+t},e.createElement("div",{className:"ae-container"},e.createElement("span",{className:"ae-container-dropdown-selected-item"},t),e.createElement("span",{className:"ae-icon-arrow"}))),o)},_checkActive:function(e){var t=this.props.editor.get("nativeEditor");e=CKEDITOR.tools.merge({element:"span"},e);var n=new CKEDITOR.style(e);return n.checkActive(t.elementPath(),t)},_getStyles:function(){return this.props.styles||[{name:AlloyEditor.Strings.h1,style:{element:"h1"}},{name:AlloyEditor.Strings.h2,style:{element:"h2"}},{name:AlloyEditor.Strings.formatted,style:{element:"pre"}},{name:AlloyEditor.Strings.cite,style:{element:"cite"}},{name:AlloyEditor.Strings.code,style:{element:"code"}}]}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonStyles=t}(),function(){var t=e.createClass({displayName:"ButtonSubscript",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"subscript"},getDefaultProps:function(){return{command:"subscript",style:{element:"sub"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.subscript,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-subscript",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.subscript},e.createElement("span",{className:"ae-icon-subscript"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonSubscript=t}(),function(){var t=e.createClass({displayName:"ButtonSuperscript",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"superscript"},getDefaultProps:function(){return{command:"superscript",style:{element:"sup"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.superscript,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-superscript",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.superscript},e.createElement("span",{className:"ae-icon-superscript"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonSuperscript=t}(),function(){var t=e.createClass({displayName:"ButtonTableCell",propTypes:{commands:e.PropTypes.arrayOf(e.PropTypes.object),editor:e.PropTypes.object.isRequired,expanded:e.PropTypes.bool,label:e.PropTypes.string,tabIndex:e.PropTypes.number,toggleDropdown:e.PropTypes.func},statics:{key:"tableCell"},render:function(){var n,o;return this.props.expanded&&(o=t.key+"List",n=e.createElement(AlloyEditor.ButtonCommandsList,{commands:this._getCommands(),editor:this.props.editor,listId:o,onDismiss:this.props.toggleDropdown})),e.createElement("div",{className:"ae-container ae-has-dropdown"},e.createElement("button",{"aria-expanded":this.props.expanded,"aria-label":AlloyEditor.Strings.cell,"aria-owns":o,className:"ae-button",onClick:this.props.toggleDropdown,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.cell},e.createElement("span",{className:"ae-icon-cell"})),n)},_getCommands:function(){return this.props.commands||[{command:"cellInsertBefore",label:AlloyEditor.Strings.cellInsertBefore},{command:"cellInsertAfter",label:AlloyEditor.Strings.cellInsertAfter},{command:"cellDelete",label:AlloyEditor.Strings.cellDelete},{command:"cellMerge",label:AlloyEditor.Strings.cellMerge},{command:"cellMergeDown",label:AlloyEditor.Strings.cellMergeDown},{command:"cellMergeRight",label:AlloyEditor.Strings.cellMergeRight},{command:"cellHorizontalSplit",label:AlloyEditor.Strings.cellSplitHorizontal},{command:"cellVerticalSplit",label:AlloyEditor.Strings.cellSplitVertical}]}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonTableCell=t}(),function(){var t=e.createClass({displayName:"ButtonTableColumn",propTypes:{commands:e.PropTypes.arrayOf(e.PropTypes.object),editor:e.PropTypes.object.isRequired,expanded:e.PropTypes.bool,label:e.PropTypes.string,tabIndex:e.PropTypes.number,toggleDropdown:e.PropTypes.func},statics:{key:"tableColumn"},render:function(){var n,o;return this.props.expanded&&(o=t.key+"List",n=e.createElement(AlloyEditor.ButtonCommandsList,{commands:this._getCommands(),editor:this.props.editor,listId:o,onDismiss:this.props.toggleDropdown})),e.createElement("div",{className:"ae-container ae-has-dropdown"},e.createElement("button",{"aria-expanded":this.props.expanded,"aria-label":AlloyEditor.Strings.column,"aria-owns":o,className:"ae-button",onClick:this.props.toggleDropdown,role:"listbox",tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.column},e.createElement("span",{className:"ae-icon-column"})),n)},_getCommands:function(){return this.props.commands||[{command:"columnInsertBefore",label:AlloyEditor.Strings.columnInsertBefore},{command:"columnInsertAfter",label:AlloyEditor.Strings.columnInsertAfter},{command:"columnDelete",label:AlloyEditor.Strings.columnDelete}]}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonTableColumn=t}(),function(){var n=13,o=27,i=e.createClass({displayName:"ButtonTableEdit",propTypes:{cancelExclusive:e.PropTypes.func.isRequired,editor:e.PropTypes.object.isRequired},statics:{key:"tableEdit"},getDefaultProps:function(){return{tableAttributes:{border:1,cellPadding:0,cellSpacing:0,style:"width: 100%"}}},componentDidMount:function(){t.findDOMNode(this.refs.rows).focus()},getInitialState:function(){return{cols:3,rows:3}},_createTable:function(){var e=this.props.editor.get("nativeEditor"),t=new CKEDITOR.Table(e);t.create({attrs:this.props.tableAttributes,cols:this.state.cols,rows:this.state.rows}),this.props.cancelExclusive(),e.fire("actionPerformed",this)},_handleChange:function(e,t){var n={};n[e]=t.target.value,this.setState(n)},_handleKeyDown:function(e){(e.keyCode===n||e.keyCode===o)&&e.preventDefault(),e.keyCode===n?this._createTable():e.keyCode===o&&this.props.cancelExclusive()},render:function(){var t=Date.now(),n=t+"rows",o=t+"cols";return e.createElement("div",{className:"ae-container-edit-table"},e.createElement("label",{htmlFor:n},"Rows"),e.createElement("div",{className:"ae-container-input small"},e.createElement("input",{className:"ae-input",id:n,onChange:this._handleChange.bind(this,"rows"),min:"1",onKeyDown:this._handleKeyDown,placeholder:"Rows",ref:"rows",type:"number",value:this.state.rows})),e.createElement("label",{htmlFor:o},"Cols"),e.createElement("div",{className:"ae-container-input small"},e.createElement("input",{className:"ae-input",id:o,onChange:this._handleChange.bind(this,"cols"),min:"1",onKeyDown:this._handleKeyDown,placeholder:"Colums",ref:"cols",type:"number",value:this.state.cols})),e.createElement("button",{"aria-label":"Confirm",className:"ae-button",onClick:this._createTable
},e.createElement("span",{className:"ae-icon-ok"})))}});AlloyEditor.Buttons[i.key]=AlloyEditor.ButtonTableEdit=i}(),function(){var t=e.createClass({displayName:"ButtonTableHeading",propTypes:{commands:e.PropTypes.arrayOf(e.PropTypes.object),editor:e.PropTypes.object.isRequired,expanded:e.PropTypes.bool,label:e.PropTypes.string,tabIndex:e.PropTypes.number,toggleDropdown:e.PropTypes.func},statics:{key:"tableHeading"},render:function(){var n,o;this.props.expanded&&(o=t.key+"List",n=e.createElement(AlloyEditor.ButtonCommandsList,{commands:this._getCommands(),editor:this.props.editor,listId:o,onDismiss:this.props.toggleDropdown}));var i=new CKEDITOR.Table(this.props.editor.get("nativeEditor")).getHeading(),r=AlloyEditor.Strings.headers+":",a=AlloyEditor.Strings["headers"+i];return e.createElement("div",{className:"ae-container-dropdown-xl ae-has-dropdown"},e.createElement("button",{"aria-expanded":this.props.expanded,"aria-label":"",className:"ae-toolbar-element",onClick:this.props.toggleDropdown,role:"combobox",tabIndex:this.props.tabIndex,title:""},e.createElement("div",{className:"ae-container"},e.createElement("span",{className:"ae-container-dropdown-selected-item"},r," ",e.createElement("strong",null,a)),e.createElement("span",{className:"ae-icon-arrow"}))),n)},_getCommands:function(){return this.props.commands||[{command:"tableHeadingNone",label:AlloyEditor.Strings.headersNone},{command:"tableHeadingRow",label:AlloyEditor.Strings.headersRow},{command:"tableHeadingColumn",label:AlloyEditor.Strings.headersColumn},{command:"tableHeadingBoth",label:AlloyEditor.Strings.headersBoth}]}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonTableHeading=t}(),function(){var t=e.createClass({displayName:"ButtonTableRemove",propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"tableRemove"},render:function(){return e.createElement("button",{"aria-label":AlloyEditor.Strings.deleteTable,className:"ae-button","data-type":"button-table-remove",onClick:this._removeTable,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.deleteTable},e.createElement("span",{className:"ae-icon-close"}))},_removeTable:function(){var e=this.props.editor.get("nativeEditor"),t=new CKEDITOR.Table(e);t.remove(),e.fire("actionPerformed",this)}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonTableRemove=t}(),function(){var t=e.createClass({displayName:"ButtonTableRow",propTypes:{commands:e.PropTypes.arrayOf(e.PropTypes.object),editor:e.PropTypes.object.isRequired,expanded:e.PropTypes.bool,label:e.PropTypes.string,tabIndex:e.PropTypes.number,toggleDropdown:e.PropTypes.func},statics:{key:"tableRow"},render:function(){var n,o;return this.props.expanded&&(o=t.key+"List",n=e.createElement(AlloyEditor.ButtonCommandsList,{commands:this._getCommands(),editor:this.props.editor,listId:o,onDismiss:this.props.toggleDropdown})),e.createElement("div",{className:"ae-container ae-has-dropdown"},e.createElement("button",{"aria-expanded":this.props.expanded,"aria-label":AlloyEditor.Strings.row,"aria-owns":o,className:"ae-button",onClick:this.props.toggleDropdown,role:"combobox",tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.row},e.createElement("span",{className:"ae-icon-row"})),n)},_getCommands:function(){return this.props.commands||[{command:"rowInsertBefore",label:AlloyEditor.Strings.rowInsertBefore},{command:"rowInsertAfter",label:AlloyEditor.Strings.rowInsertAfter},{command:"rowDelete",label:AlloyEditor.Strings.rowDelete}]}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonTableRow=t}(),function(){var t=e.createClass({displayName:"ButtonTable",propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"table"},render:function(){return this.props.renderExclusive?e.createElement(AlloyEditor.ButtonTableEdit,this.props):e.createElement("button",{"aria-label":AlloyEditor.Strings.table,className:"ae-button","data-type":"button-table",onClick:this.props.requestExclusive,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.table},e.createElement("span",{className:"ae-icon-table"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonTable=t}(),function(){var t=e.createClass({displayName:"ButtonTwitter",mixins:[AlloyEditor.ButtonStateClasses],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"twitter"},handleClick:function(){var e=this.props.editor.get("nativeEditor"),t=new CKEDITOR.Link(e);this.isActive()?t.remove(t.getFromSelection()):t.create(this._getHref(),{"class":"ae-twitter-link",target:"_blank"}),e.fire("actionPerformed",this)},isActive:function(){var e=new CKEDITOR.Link(this.props.editor.get("nativeEditor")).getFromSelection();return e&&-1!==e.getAttribute("href").indexOf("twitter.com/intent/tweet")},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.twitter,className:t,"data-type":"button-twitter",onClick:this.handleClick,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.twitter},e.createElement("span",{className:"ae-icon-twitter"}))},_getHref:function(){var e=this.props.editor.get("nativeEditor"),t=e.getSelection().getSelectedText(),n=this.props.url,o=this.props.via,i="https://twitter.com/intent/tweet?text="+t;return n&&(i+="&url="+n),o&&(i+="&via="+o),i}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonTwitter=t}(),function(){var t=e.createClass({displayName:"ButtonUnorderedlist",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"ul"},getDefaultProps:function(){return{command:"bulletedlist",style:{element:"ul"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.bulletedlist,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-ul",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.bulletedlist},e.createElement("span",{className:"ae-icon-bulleted-list"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonUnorderedlist=t}(),function(){var t=e.createClass({displayName:"ButtonUnderline",mixins:[AlloyEditor.ButtonStyle,AlloyEditor.ButtonStateClasses,AlloyEditor.ButtonCommand],propTypes:{editor:e.PropTypes.object.isRequired,label:e.PropTypes.string,tabIndex:e.PropTypes.number},statics:{key:"underline"},getDefaultProps:function(){return{command:"underline",style:{element:"u"}}},render:function(){var t="ae-button "+this.getStateClasses();return e.createElement("button",{"aria-label":AlloyEditor.Strings.underline,"aria-pressed":-1!==t.indexOf("pressed"),className:t,"data-type":"button-underline",onClick:this.execCommand,tabIndex:this.props.tabIndex,title:AlloyEditor.Strings.underline},e.createElement("span",{className:"ae-icon-underline"}))}});AlloyEditor.Buttons[t.key]=AlloyEditor.ButtonUnderline=t}(),function(){var n=e.createClass({displayName:"ToolbarAdd",mixins:[AlloyEditor.WidgetDropdown,AlloyEditor.WidgetExclusive,AlloyEditor.WidgetFocusManager,AlloyEditor.ToolbarButtons,AlloyEditor.WidgetPosition,AlloyEditor.WidgetArrowBox],propTypes:{config:e.PropTypes.object,editor:e.PropTypes.object.isRequired,editorEvent:e.PropTypes.object,gutterExclusive:e.PropTypes.object,label:e.PropTypes.string,onDismiss:e.PropTypes.func,selectionData:e.PropTypes.object},statics:{key:"add"},getDefaultProps:function(){return{circular:!0,descendants:".ae-button",gutterExclusive:{left:10,top:0},keys:{dismiss:[27],next:[39,40],prev:[37,38]}}},componentDidMount:function(){this._updatePosition()},componentDidUpdate:function(e,t){this._updatePosition(),this.props.renderExclusive&&this.focus()},render:function(){if(this.props.editorEvent&&!this.props.editorEvent.data.nativeEvent.target.isContentEditable)return null;var t=this._getButtons(),n=this._getToolbarClassName();return e.createElement("div",{"aria-label":AlloyEditor.Strings.add,className:n,"data-tabindex":this.props.config.tabIndex||0,onFocus:this.focus,onKeyDown:this.handleKey,role:"toolbar",tabIndex:"-1"},e.createElement("div",{className:"ae-container"},t))},_getButtons:function(){var t;return this.props.renderExclusive?t=this.getToolbarButtons(this.props.config.buttons):this.props.selectionData&&this.props.selectionData.region&&(t=e.createElement("button",{"aria-label":AlloyEditor.Strings.add,className:"ae-button ae-button-add",onClick:this.props.requestExclusive.bind(this,n.key),title:AlloyEditor.Strings.add},e.createElement("span",{className:"ae-icon-add"}))),t},_getToolbarClassName:function(){var e="ae-toolbar-add";return this.props.renderExclusive&&(e="ae-toolbar "+this.getArrowBoxClasses()),e},_updatePosition:function(){if(t.findDOMNode(this))if(this.props.renderExclusive){this.updatePosition(),this.show();var e}else if(this.props.selectionData&&(e=this.props.selectionData.region),e){var n=t.findDOMNode(this),o=new CKEDITOR.dom.element(n),i=e.startRect||e,r=this.props.editor.get("nativeEditor").editable().getClientRect().left;n.style.left=r-n.offsetWidth-this.props.gutterExclusive.left+"px",n.style.top=Math.floor(e.top-n.offsetHeight/2+i.height/2)+"px",n.style.opacity=1,o.removeClass("ae-arrow-box"),this.cancelAnimation()}}});AlloyEditor.Toolbars[n.key]=AlloyEditor.ToolbarAdd=n}(),function(){var n=e.createClass({displayName:"ToolbarStyles",mixins:[AlloyEditor.WidgetDropdown,AlloyEditor.WidgetExclusive,AlloyEditor.WidgetFocusManager,AlloyEditor.ToolbarButtons,AlloyEditor.WidgetPosition,AlloyEditor.WidgetArrowBox],propTypes:{config:e.PropTypes.object,editor:e.PropTypes.object.isRequired,editorEvent:e.PropTypes.object,label:e.PropTypes.string,onDismiss:e.PropTypes.func,selectionData:e.PropTypes.object},statics:{key:"styles"},componentDidMount:function(){this._updatePosition()},componentDidUpdate:function(e,t){this._updatePosition()},getDefaultProps:function(){return{circular:!0,descendants:".ae-button, .ae-toolbar-element",keys:{dismiss:[27],next:[39,40],prev:[37,38]}}},render:function(){var t=this._getCurrentSelection();if(t){var n,o=this._getSelectionFunction(t.getArrowBoxClasses);n=o?o():this.getArrowBoxClasses();var i="ae-toolbar-styles "+n,r=this.getToolbarButtons(t.buttons,{selectionType:t.name});return e.createElement("div",{"aria-label":AlloyEditor.Strings.styles,className:i,"data-tabindex":this.props.config.tabIndex||0,onFocus:this.focus,onKeyDown:this.handleKey,role:"toolbar",tabIndex:"-1"},e.createElement("div",{className:"ae-container"},r))}return null},_getSelectionFunction:function(e){var t,n=AlloyEditor.Lang;if(n.isFunction(e))t=e;else if(n.isString(e)){for(var o=e.split("."),i=window,r=o.shift();r&&n.isObject(i)&&n.isObject(i[r]);)i=i[r],r=o.shift();n.isFunction(i)&&(t=i)}return t},_getCurrentSelection:function(){var e,t=this.props.editorEvent?this.props.editorEvent.data:null;return t&&this.props.config.selections.some(function(n){var o,i=this._getSelectionFunction(n.test);return i&&(o=i({data:t,editor:this.props.editor})),o&&(e=n),o},this),e},_updatePosition:function(){if(t.findDOMNode(this)){var e,n=this._getCurrentSelection();if(n){var o=this._getSelectionFunction(n.setPosition);o&&(e=o.call(this,{editor:this.props.editor,editorEvent:this.props.editorEvent,selectionData:this.props.selectionData}))}e||(this.updatePosition(),this.show())}}});AlloyEditor.Toolbars[n.key]=AlloyEditor.ToolbarStyles=n}(),function(){var n=e.createClass({displayName:"UI",mixins:[AlloyEditor.WidgetExclusive,AlloyEditor.WidgetFocusManager],propTypes:{ariaUpdates:e.PropTypes.object,editor:e.PropTypes.object.isRequired,eventsDelay:e.PropTypes.number,toolbars:e.PropTypes.object.isRequired},getInitialState:function(){return{hidden:!1}},getDefaultProps:function(){return{circular:!0,descendants:"[class^=ae-toolbar-]",eventsDelay:0,keys:{next:9}}},componentDidMount:function(){var e=this.props.editor.get("nativeEditor");e.on("editorInteraction",this._onEditorInteraction,this),e.on("actionPerformed",this._onActionPerformed,this),e.on("key",this._onEditorKey,this),this._mousedownListener=function(e){this._setUIHidden(e.target)}.bind(this),this._keyDownListener=CKEDITOR.tools.debounce(function(e){this._setUIHidden(document.activeElement)},this.props.eventsDelay,this),document.addEventListener("mousedown",this._mousedownListener),document.addEventListener("keydown",this._keyDownListener)},componentDidUpdate:function(e,n){var o=t.findDOMNode(this),i=this.props.editor.get("nativeEditor");o&&i.fire("ariaUpdate",{message:this._getAvailableToolbarsMessage(o)}),i.fire("editorUpdate",{prevProps:e,prevState:n,props:this.props,state:this.state})},_getAriaUpdateTemplate:function(e){return this._ariaUpdateTemplates||(this._ariaUpdateTemplates={}),this._ariaUpdateTemplates[e]||(this._ariaUpdateTemplates[e]=new CKEDITOR.template(this._getAriaUpdates()[e])),this._ariaUpdateTemplates[e]},_getAriaUpdates:function(){return this.props.ariaUpdates||{noToolbar:AlloyEditor.Strings.ariaUpdateNoToolbar,oneToolbar:AlloyEditor.Strings.ariaUpdateOneToolbar,manyToolbars:AlloyEditor.Strings.ariaUpdateManyToolbars}},_getAvailableToolbarsMessage:function(e){var t=e.querySelectorAll('[role="toolbar"]');if(t.length){var n=Array.prototype.slice.call(t).map(function(e){return e.getAttribute("aria-label")}),o=1===n.length?"oneToolbar":"manyToolbars";return this._getAriaUpdateTemplate(o).output({toolbars:n.join(",").replace(/,([^,]*)$/," and $1")})}return this._getAriaUpdates().noToolbar},componentWillUnmount:function(){this._mousedownListener&&document.removeEventListener("mousedown",this._mousedownListener),this._keyDownListener&&(this._keyDownListener.detach(),document.removeEventListener("keydown",this._keyDownListener))},render:function(){if(this.state.hidden)return null;var t=Object.keys(this.props.toolbars).map(function(e){return AlloyEditor.Toolbars[e]||window[e]});return t=this.filterExclusive(t).map(function(t){var n=this.mergeExclusiveProps({config:this.props.toolbars[t.key],editor:this.props.editor,editorEvent:this.state.editorEvent,key:t.key,onDismiss:this._onDismissToolbarFocus,selectionData:this.state.selectionData},t.key);return e.createElement(t,n)}.bind(this)),e.createElement("div",{className:"ae-toolbars",onKeyDown:this.handleKey},t)},_onActionPerformed:function(e){var t=this.props.editor.get("nativeEditor");t.focus(),this.setState({itemExclusive:null,selectionData:t.getSelectionData()})},_onDismissToolbarFocus:function(){var e=this.props.editor.get("nativeEditor");e.focus()},_onEditorInteraction:function(e){this.setState({editorEvent:e,hidden:!1,itemExclusive:null,selectionData:e.data.selectionData})},_onEditorKey:function(e){var t=e.data.domEvent.$;t.altKey&&121===t.keyCode&&this.focus()},_setUIHidden:function(e){var n=t.findDOMNode(this);if(n){var o=this.props.editor.get("nativeEditor").editable(),i=new CKEDITOR.dom.node(e),r=o.$===e||o.contains(i)||new CKEDITOR.dom.element(n).contains(i);r||this.setState({hidden:!0})}}});AlloyEditor.UI=n}())}();