<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/core/selection-region.js - AlloyEditor</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="AlloyEditor"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AlloyEditor.html">AlloyEditor</a></li>
            
                <li><a href="../classes/ButtonA.html">ButtonA</a></li>
            
                <li><a href="../classes/ButtonBase.html">ButtonBase</a></li>
            
                <li><a href="../classes/ButtonImage.html">ButtonImage</a></li>
            
                <li><a href="../classes/ButtonLeft.html">ButtonLeft</a></li>
            
                <li><a href="../classes/ButtonU.html">ButtonU</a></li>
            
                <li><a href="../classes/CKEDITOR.Link.html">CKEDITOR.Link</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.dropimages.html">CKEDITOR.plugins.dropimages</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.placeholder.html">CKEDITOR.plugins.placeholder</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.selectionregion.html">CKEDITOR.plugins.selectionregion</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.uicore.html">CKEDITOR.plugins.uicore</a></li>
            
                <li><a href="../classes/CKEDITOR.tools.html">CKEDITOR.tools</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/core/selection-region.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function() {
    &#x27;use strict&#x27;;

    if (CKEDITOR.plugins.get(&#x27;selectionregion&#x27;)) {
        return;
    }

    CKEDITOR.SELECTION_TOP_TO_BOTTOM = 0;
    CKEDITOR.SELECTION_BOTTOM_TO_TOP = 1;

    /**
     * SelectionRegion utility class which provides metadata about the selection. The metadata may be the start and end
     * rectangles, caret region, etc. **This class is not intended to be used standalone. Its functions will
     * be merged into each editor instance, so the developer may use them directly via the editor, without making
     * an instance of this class**.
     *
     * @class CKEDITOR.plugins.selectionregion
     * @constructor
     */
    function SelectionRegion() {}

    SelectionRegion.prototype = {
        constructor: SelectionRegion,

        /**
         * Creates selection from two points in page coordinates.
         *
         * @method createSelectionFromPoint
         * @param {Number} x X point in page coordinates.
         * @param {Number} y Y point in page coordinates.
         */
        createSelectionFromPoint: function(x, y) {
            this.createSelectionFromRange(x, y, x, y);
        },

        /**
         * Creates selection from range. A range contains of two points in page coordinates.
         *
         * @method createSelectionFromRange
         * @param {Number} startX X coordinate of the first point.
         * @param {Number} startY Y coordinate of the first point.
         * @param {Number} endX X coordinate of the second point.
         * @param {Number} endY Y coordinate of the second point.
         */
        createSelectionFromRange: function(startX, startY, endX, endY) {
            var editor,
                end,
                endContainer,
                endOffset,
                endRange,
                range,
                selection,
                start,
                startContainer,
                startOffset;

            editor = this.editor;

            if (typeof document.caretPositionFromPoint == &#x27;function&#x27;) {
                start = document.caretPositionFromPoint(startX, startY);
                end = document.caretPositionFromPoint(endX, endY);

                startContainer = start.offsetNode;
                endContainer = end.offsetNode;

                startOffset = start.offset;
                endOffset = end.offset;

                range = this.createRange();
            } else if (typeof document.caretRangeFromPoint == &#x27;function&#x27;) {
                start = document.caretRangeFromPoint(startX, startY);
                end = document.caretRangeFromPoint(endX, endY);

                startContainer = start.startContainer;
                endContainer = end.startContainer;

                startOffset = start.startOffset;
                endOffset = end.startOffset;

                range = this.createRange();
            }

            if (range &amp;&amp; document.getSelection) {
                range.setStart(new CKEDITOR.dom.node(startContainer), startOffset);
                range.setEnd(new CKEDITOR.dom.node(endContainer), endOffset);

                this.getSelection().selectRanges([range]);
            } else if (typeof document.body.createTextRange == &#x27;function&#x27;) {
                selection = this.getSelection();

                selection.unlock();

                range = document.body.createTextRange();
                range.moveToPoint(startX, startY);

                endRange = range.duplicate();
                endRange.moveToPoint(endX, endY);

                range.setEndPoint(&#x27;EndToEnd&#x27;, endRange);
                range.select();

                this.getSelection().lock();
            }
        },

        /**
         * Returns the region of the current position of the caret.
         *
         * @method getCaretRegion
         * @return {Object} Returns object with the following properties:
         * - bottom
         * - left
         * - right
         * - top
         */
        getCaretRegion: function() {
            var bookmarkNodeEl,
                bookmarks,
                docScrollX,
                docScrollXY,
                docScrollY,
                region,
                selection;

            selection = this.getSelection();

            bookmarks = selection.createBookmarks();
            bookmarkNodeEl = bookmarks[0].startNode.$;

            bookmarkNodeEl.style.display = &#x27;inline-block&#x27;;

            region = new CKEDITOR.dom.element(bookmarkNodeEl).getClientRect();

            bookmarkNodeEl.parentNode.removeChild(bookmarkNodeEl);

            docScrollXY = this._getDocScrollXY();
            docScrollX = docScrollXY[0];
            docScrollY = docScrollXY[1];

            return {
                bottom: docScrollY + region.bottom,
                left: docScrollX + region.left,
                right: docScrollX + region.right,
                top: docScrollY + region.top
            };
        },

        /**
         * Returns data for the current selection.
         *
         * @method getSelectionData
         * @return {Object} Returns object with the following data:
         * - element - The currently selected element, if any
         * - text - The selected text
         * - region - The data, returned from {{#crossLink &quot;CKEDITOR.plugins.selectionregion/getSelectionRegion:method&quot;}}{{/crossLink}}
         */
        getSelectionData: function() {
            var result,
                selection;

            selection = this.getSelection();

            result = {
                element: selection.getSelectedElement(),
                text: selection.getSelectedText()
            };

            result.region = this.getSelectionRegion(selection);

            return result;
        },

        /**
         * Returns the region of the current selection.
         *
         * @method getSelectionRegion
         * @return {Object} Returns object which is being returned from
         * {{#crossLink &quot;CKEDITOR.plugins.selectionregion/getClientRectsRegion:method&quot;}}{{/crossLink}} with three more properties:
         * - direction - the direction of the selection. Can be one of these:
         *   1. CKEDITOR.SELECTION_TOP_TO_BOTTOM
         *   2. CKEDITOR.SELECTION_BOTTOM_TO_TOP
         * - height - The height of the selection region
         * - width - The width of the selection region
         */
        getSelectionRegion: function() {
            var direction,
                region;

            direction = CKEDITOR.SELECTION_TOP_TO_BOTTOM;

            region = this.getClientRectsRegion();

            region.direction = this._getSelectionDirection();

            region.height = region.bottom - region.top;
            region.width = region.right - region.left;

            return region;
        },

        /**
         * Returns true if the current selection is empty, false otherwise.
         *
         * @method isSelectionEmpty
         * @return {Boolean} Returns true if the current selection is empty, false otherwise.
         */
        isSelectionEmpty: function() {
            var ranges,
                selection = this.getSelection();

            return (selection.getType() === CKEDITOR.SELECTION_NONE) ||
                ((ranges = selection.getRanges()) &amp;&amp; ranges.length === 1 &amp;&amp; ranges[0].collapsed);
        },

        /**
         * Returns object with data about the [client rectangles](https://developer.mozilla.org/en-US/docs/Web/API/Element.getClientRects) of the selection,
         * normalized across browses. All offsets below are in page coordinates.
         *
         * @method getClientRectsRegion
         * @return {Object} Returns object with the following data:
         * - bottom - bottom offset of all client rectangles
         * - left - left offset of all client rectangles
         * - right - right offset of all client rectangles
         * - top - top offset of all client rectangles
         * - startRect - An Object, which contains the following information:
         *     + bottom - bottom offset
         *     + height - the height of the rectangle
         *     + left - left offset of the selection
         *     + right - right offset of the selection
         *     + top - top offset of the selection
         *     + width - the width of the rectangle
         * - endRect - An Object, which contains the following information:
         *     + bottom - bottom offset
         *     + height - the height of the rectangle
         *     + left - left offset of the selection
         *     + right - right offset of the selection
         *     + top - top offset of the selection
         *     + width - the width of the rectangle
         */
        getClientRectsRegion: function() {
            var bottom,
                clientRects,
                docScrollX,
                docScrollXY,
                docScrollY,
                endRect,
                i,
                item,
                left,
                length,
                nativeSelection,
                range,
                rangeCount,
                region,
                right,
                selection,
                startRect,
                top;

            selection = this.getSelection();
            nativeSelection = selection.getNative();

            if (nativeSelection.createRange) {
                range = nativeSelection.createRange();
                clientRects = range.getClientRects();
            } else {
                rangeCount = nativeSelection.rangeCount;
                clientRects = (nativeSelection.rangeCount &gt; 0) ? nativeSelection.getRangeAt(0).getClientRects() : [];
            }

            bottom = 0;
            left = Infinity;
            right = -Infinity;
            top = Infinity;

            if (clientRects.length === 0) {
                region = this.getCaretRegion();
            } else {
                for (i = 0, length = clientRects.length; i &lt; length; i++) {
                    item = clientRects[i];

                    if (item.left &lt; left) {
                        left = item.left;
                    }

                    if (item.right &gt; right) {
                        right = item.right;
                    }

                    if (item.top &lt; top) {
                        top = item.top;
                    }

                    if (item.bottom &gt; bottom) {
                        bottom = item.bottom;
                    }
                }

                docScrollXY = this._getDocScrollXY();
                docScrollX = docScrollXY[0];
                docScrollY = docScrollXY[1];

                region = {
                    bottom: docScrollY + bottom,
                    left: docScrollX + left,
                    right: docScrollX + right,
                    top: docScrollY + top
                };

                if (clientRects.length) {
                    endRect = clientRects[clientRects.length - 1];
                    startRect = clientRects[0];

                    region.endRect = {
                        bottom: docScrollY + endRect.bottom,
                        height: endRect.height,
                        left: docScrollX + endRect.left,
                        right: docScrollX + endRect.right,
                        top: docScrollY + endRect.top,
                        width: endRect.width
                    };

                    region.startRect = {
                        bottom: docScrollY + startRect.bottom,
                        height: startRect.height,
                        left: docScrollX + startRect.left,
                        right: docScrollX + startRect.right,
                        top: docScrollY + startRect.top,
                        width: startRect.width
                    };
                }
            }

            return region;
        },

        /**
         * Retrieves document scrollX and scrollY in an array.
         *
         * @method _getDocScrollXY
         * @protected
         * @return {Array} Returns an array with two items - document scrollX and scrollY in page coordinates.
         */
        _getDocScrollXY: function() {
            var docBody,
                docDefaultView,
                docElement,
                pageXOffset,
                pageYOffset;

            docBody = document.body;
            docDefaultView = document.defaultView;
            docElement = document.documentElement;

            pageXOffset = (docDefaultView) ? docDefaultView.pageXOffset : 0;
            pageYOffset = (docDefaultView) ? docDefaultView.pageYOffset : 0;

            return [
                Math.max(docElement.scrollLeft, docBody.scrollLeft, pageXOffset),
                Math.max(docElement.scrollTop, docBody.scrollTop, pageYOffset)
            ];
        },

        /**
         * Retrieves the direction of the selection. The direction is from top to bottom or from bottom to top.
         * For IE &lt; 9 it is not possible, so the direction for these browsers will be always CKEDITOR.SELECTION_TOP_TO_BOTTOM.
         *
         * @method _getSelectionDirection
         * @protected
         * @return {Number} Returns a number which represents selection direction. It might be one of these:
         * - CKEDITOR.SELECTION_TOP_TO_BOTTOM;
         * - CKEDITOR.SELECTION_BOTTOM_TO_TOP;
         */
        _getSelectionDirection: function() {
            var anchorNode,
                direction,
                nativeSelection,
                position,
                selection;

            selection = this.getSelection();
            nativeSelection = selection.getNative();

            direction = CKEDITOR.SELECTION_TOP_TO_BOTTOM;

            if ((anchorNode = nativeSelection.anchorNode) &amp;&amp; anchorNode.compareDocumentPosition) {
                position = anchorNode.compareDocumentPosition(nativeSelection.focusNode);

                if (!position &amp;&amp; nativeSelection.anchorOffset &gt; nativeSelection.focusOffset || position === Node.DOCUMENT_POSITION_PRECEDING) {
                    direction = CKEDITOR.SELECTION_BOTTOM_TO_TOP;
                }
            }

            return direction;
        }
    };

    CKEDITOR.plugins.add(
        &#x27;selectionregion&#x27;, {
            init: function(editor) {
                var attr,
                    hasOwnProperty;

                hasOwnProperty = Object.prototype.hasOwnProperty;

                for (attr in SelectionRegion.prototype) {
                    if (hasOwnProperty.call(SelectionRegion.prototype, attr) &amp;&amp; typeof editor[attr] == &#x27;undefined&#x27;) {
                        editor[attr] = SelectionRegion.prototype[attr];
                    }
                }
            }
        }
    );
}());
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
